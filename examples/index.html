<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Examples - FetalSynthGen</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Examples";
        var mkdocs_page_input_path = "examples.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../media/fetsynthgen_logo.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">FetalSynthGen GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../usage/">How to use the generator?</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Examples</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#recommended-using-configuration-files">Recommended: Using Configuration Files</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#steps-to-use-configuration-files">Steps to Use Configuration Files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-direct-instantiation">Using Direct Instantiation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#additional-resources">Additional Resources</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../seed_generation/">Seed Generation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configs/">Configs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../datasets/">Datasets</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../generation/">Generation</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">FetalSynthGen</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Usage</li>
      <li class="breadcrumb-item active">Examples</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="examples">Examples</h1>
<p>After installing the package, you can directly use the generator and datasets in your project. See the following examples for guidance on how to instantiate the generator and datasets.</p>
<h2 id="recommended-using-configuration-files">Recommended: Using Configuration Files</h2>
<p>For reproducibility and greater flexibility, we recommend using the configuration files provided in the package. These files define the parameters for the generator and datasets, allowing for quick and easy setup with <a href="https://hydra.cc/"><code>hydra</code></a>.</p>
<h3 id="steps-to-use-configuration-files">Steps to Use Configuration Files</h3>
<ol>
<li>Copy the configuration files (entire <a href="https://github.com/Medical-Image-Analysis-Laboratory/fetalsyngen/tree/dev/configs/dataset"><code>configs/dataset</code></a> folder) to your project root directory into <code>configs/dataset</code>.</li>
<li>Use the following methods to instantiate the generator and dataset classes:</li>
</ol>
<p>For examples below, set up <code>cfg_path = "configs/dataset"</code> as the path to the configuration files and <code>cfg_name</code> as the name of the configuration file you want to use (<code>cfg_name='synth_train'</code> for example for the synthetic training dataset).</p>
<p>See the <a href="../configs/"><code>Configs</code></a> page for detailed information on configuration files and available generation modes.</p>
<details open>

Using the Imperative API

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">hydra</span>

<span class="k">with</span> <span class="n">hydra</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="n">cfg_path</span><span class="p">,</span> <span class="n">version_base</span><span class="o">=</span><span class="s2">&quot;1.2&quot;</span><span class="p">):</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">hydra</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">config_name</span><span class="o">=</span><span class="n">cfg_name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Composed config: </span><span class="si">{</span><span class="n">cfg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">hydra</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</code></pre></div>

Using the Declarative API

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">hydra</span>
<span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">DictConfig</span>

<span class="nd">@hydra</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">config_path</span><span class="o">=</span><span class="n">cfg_path</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="n">cfg_name</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_app</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</code></pre></div>
</details>
<p><br></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ensure that the <code>bids</code> and <code>seeds</code> paths in the configuration files are updated to the absolute paths for your data.</p>
</div>
<h2 id="using-direct-instantiation">Using Direct Instantiation</h2>
<p>You can manually instantiate required classes from the <code>FetalSynthGen</code> in your project as needed. For example, to instantiate the <code>FetalSynthDataset</code> class and generator components follow the example below:</p>
<details close>

<div class="highlight"><pre><span></span><code><span class="c1"># Import necessary classes</span>
<span class="kn">from</span> <span class="nn">fetalsyngen.data.datasets</span> <span class="kn">import</span> <span class="n">FetalSynthDataset</span>

<span class="kn">from</span> <span class="nn">fetalsyngen.generator.model</span> <span class="kn">import</span> <span class="n">FetalSynthGen</span>
<span class="kn">from</span> <span class="nn">fetalsyngen.generator.augmentation.synthseg</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RandBiasField</span><span class="p">,</span>
    <span class="n">RandGamma</span><span class="p">,</span>
    <span class="n">RandNoise</span><span class="p">,</span>
    <span class="n">RandResample</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">fetalsyngen.generator.deformation.affine_nonrigid</span> <span class="kn">import</span> <span class="n">SpatialDeformation</span>
<span class="kn">from</span> <span class="nn">fetalsyngen.generator.intensity.rand_gmm</span> <span class="kn">import</span> <span class="n">ImageFromSeeds</span>

<span class="c1"># Instantiate the generator components</span>
<span class="n">intensity_generator</span> <span class="o">=</span> <span class="n">ImageFromSeeds</span><span class="p">(</span>
    <span class="n">min_subclusters</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_subclusters</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">seed_labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="n">generation_classes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="n">meta_labels</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">spatial_deform</span> <span class="o">=</span> <span class="n">SpatialDeformation</span><span class="p">(</span>
    <span class="n">max_rotation</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_shear</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_scaling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
    <span class="n">nonlinear_transform</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">nonlin_scale_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">nonlin_scale_max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">nonlin_std_max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">flip_prb</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">resampler</span> <span class="o">=</span> <span class="n">RandResample</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_resolution</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">min_resolution</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">bias_field</span> <span class="o">=</span> <span class="n">RandBiasField</span><span class="p">(</span>
    <span class="n">prob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">scale_min</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">scale_max</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">std_min</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">std_max</span><span class="o">=</span><span class="mf">1.5</span>
<span class="p">)</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">RandNoise</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">std_min</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">std_max</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="n">RandGamma</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">gamma_std</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Instantiate the generator</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">FetalSynthGen</span><span class="p">(</span>
    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>
    <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
    <span class="n">intensity_generator</span><span class="o">=</span><span class="n">intensity_generator</span><span class="p">,</span>
    <span class="n">spatial_deform</span><span class="o">=</span><span class="n">spatial_deform</span><span class="p">,</span>
    <span class="n">resampler</span><span class="o">=</span><span class="n">resampler</span><span class="p">,</span>
    <span class="n">bias_field</span><span class="o">=</span><span class="n">bias_field</span><span class="p">,</span>
    <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">,</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Instantiate the dataset</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">FetalSynthDataset</span><span class="p">(</span>
    <span class="n">bids_path</span><span class="o">=</span><span class="s2">&quot;./../../data&quot;</span><span class="p">,</span>
    <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">,</span>
    <span class="n">seed_path</span><span class="o">=</span><span class="s2">&quot;./../../data/derivatives/seeds&quot;</span><span class="p">,</span>
    <span class="n">sub_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

</details>

<p><br></p>
<h2 id="additional-resources">Additional Resources</h2>
<p>For more examples of generator instantiation with <code>hydra</code>, see the <a href="https://github.com/Medical-Image-Analysis-Laboratory/fetalsyngen/blob/dev/fetalsyngen/examples/generator.ipynb"><code>Generator Instantiation</code></a> notebook.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../usage/" class="btn btn-neutral float-left" title="How to use the generator?"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../seed_generation/" class="btn btn-neutral float-right" title="Seed Generation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../usage/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../seed_generation/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../configs/">
      
      
        <link rel="next" href="../generation/">
      
      
      <link rel="icon" href="../media/favicon-32x32.pngs">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>Datasets - FetalSynthGen</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4af4bdda.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#datasets" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="FetalSynthGen" class="md-header__button md-logo" aria-label="FetalSynthGen" data-md-component="logo">
      
  <img src="../media/fetsynthgen_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FetalSynthGen
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Datasets
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="FetalSynthGen" class="md-nav__button md-logo" aria-label="FetalSynthGen" data-md-component="logo">
      
  <img src="../media/fetsynthgen_logo.png" alt="logo">

    </a>
    FetalSynthGen
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FetalSynthGen GitHub
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use the generator?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../seed_generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Seed Generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets" class="md-nav__link">
    <span class="md-ellipsis">
      datasets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalDataset" class="md-nav__link">
    <span class="md-ellipsis">
      FetalDataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FetalDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalTestDataset" class="md-nav__link">
    <span class="md-ellipsis">
      FetalTestDataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FetalTestDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalTestDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalTestDataset.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalTestDataset.reverse_transform" class="md-nav__link">
    <span class="md-ellipsis">
      reverse_transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalSynthDataset" class="md-nav__link">
    <span class="md-ellipsis">
      FetalSynthDataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FetalSynthDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalSynthDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample" class="md-nav__link">
    <span class="md-ellipsis">
      sample
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalSynthDataset.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta" class="md-nav__link">
    <span class="md-ellipsis">
      sample_with_meta
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fixed-image-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Fixed Image Generation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sr_artif_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Super-resolution artifacts
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets" class="md-nav__link">
    <span class="md-ellipsis">
      datasets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalDataset" class="md-nav__link">
    <span class="md-ellipsis">
      FetalDataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FetalDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalTestDataset" class="md-nav__link">
    <span class="md-ellipsis">
      FetalTestDataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FetalTestDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalTestDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalTestDataset.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalTestDataset.reverse_transform" class="md-nav__link">
    <span class="md-ellipsis">
      reverse_transform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalSynthDataset" class="md-nav__link">
    <span class="md-ellipsis">
      FetalSynthDataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FetalSynthDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalSynthDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample" class="md-nav__link">
    <span class="md-ellipsis">
      sample
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalSynthDataset.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta" class="md-nav__link">
    <span class="md-ellipsis">
      sample_with_meta
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fixed-image-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Fixed Image Generation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="datasets">Datasets</h1>
<p>Classes for loading and processing datasets.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<blockquote>
<p><strong>📝 Device</strong>: All datasets return samples with tensors on the CPU (even when the synthetic data generation is done on the GPU). This is due to restriction on the GPU usage in the multiprocessing settings, where GPU memory cannot be easily shared between processes.</p>
<p><strong>📝 Dataloader</strong>: When using <code>torch.utils.data.DataLoader</code> ensure that you pass <code>multiprocessing_context="spawn"</code> argument to the dataloader object when using <code>FetalSynthDataset</code> to ensure that the spawned processes have access to the GPU.</p>
</blockquote>


<div class="doc doc-object doc-module">



<a id="fetalsyngen.data.datasets"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="fetalsyngen.data.datasets.FetalDataset" class="doc doc-heading">
            <code>FetalDataset</code>


</h2>


    <div class="doc doc-contents ">


        <p>Abstract class defining a dataset for loading fetal data.</p>






              <details class="quote">
                <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FetalDataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class defining a dataset for loading fetal data.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bids_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sub_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            bids_path: Path to the bids folder with the data.</span>
<span class="sd">            sub_list: List of the subjects to use. If None, all subjects are used.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bids_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_subjects</span><span class="p">(</span><span class="n">sub_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;sub-*&quot;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span> <span class="o">=</span> <span class="n">SimpleITKReader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="n">ScaleIntensity</span><span class="p">(</span><span class="n">minv</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxv</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bids_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">,</span> <span class="s2">&quot;T2w&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segm_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bids_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">,</span> <span class="s2">&quot;dseg&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_subjects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">):</span>
        <span class="n">subj_found</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;sub-*&quot;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">subj_found</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">sub_list</span><span class="p">))</span> <span class="k">if</span> <span class="n">sub_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sub_ses_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ses</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">ses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sub</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sub_ses_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_ses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bids_path</span><span class="p">,</span> <span class="n">sub</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the session names for the subject.&quot;&quot;&quot;</span>
        <span class="n">sub_path</span> <span class="o">=</span> <span class="n">bids_path</span> <span class="o">/</span> <span class="n">sub</span>
        <span class="n">ses_dir</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sub_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()]</span>
        <span class="n">ses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ses_dir</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;anat&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">ses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ses</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.nii.gz&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pattern for the file name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ses</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">/anat/</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">*_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ses</span><span class="si">}</span><span class="s2">/anat/</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ses</span><span class="si">}</span><span class="s2">*_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_bids_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;Check that for a given path, all subjects have a file with the provided suffix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">files_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pattern</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No files found for requested subject </span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2"> returned nothing)&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Multiple files found for requested subject </span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2"> returned </span><span class="si">{</span><span class="n">files</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
            <span class="n">files_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">files_paths</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subjects</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;This method should be implemented in the child class.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bids_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the bids folder with the data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sub_list</code>
            </td>
            <td>
                  <code>list[str] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of the subjects to use. If None, all subjects are used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bids_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sub_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        bids_path: Path to the bids folder with the data.</span>
<span class="sd">        sub_list: List of the subjects to use. If None, all subjects are used.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bids_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_subjects</span><span class="p">(</span><span class="n">sub_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;sub-*&quot;</span><span class="p">)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loader</span> <span class="o">=</span> <span class="n">SimpleITKReader</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="n">ScaleIntensity</span><span class="p">(</span><span class="n">minv</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxv</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bids_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">,</span> <span class="s2">&quot;T2w&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">segm_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bids_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">,</span> <span class="s2">&quot;dseg&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fetalsyngen.data.datasets.FetalTestDataset" class="doc doc-heading">
            <code>FetalTestDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="fetalsyngen.data.datasets.FetalDataset" href="#fetalsyngen.data.datasets.FetalDataset">FetalDataset</a></code></p>


        <p>Dataset class for loading fetal images offline.
Used to load test/validation data.</p>
<p>Use the <code>transforms</code> argument to pass additional processing steps
(scaling, resampling, cropping, etc.).</p>






              <details class="quote">
                <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FetalTestDataset</span><span class="p">(</span><span class="n">FetalDataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataset class for loading fetal images offline.</span>
<span class="sd">    Used to load test/validation data.</span>

<span class="sd">    Use the `transforms` argument to pass additional processing steps</span>
<span class="sd">    (scaling, resampling, cropping, etc.).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bids_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sub_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">transforms</span><span class="p">:</span> <span class="n">Compose</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            bids_path: Path to the bids folder with the data.</span>
<span class="sd">            sub_list: List of the subjects to use. If None, all subjects are used.</span>
<span class="sd">            transforms: Compose object with the transformations to apply.</span>
<span class="sd">                Default is None, no transformations are applied.</span>

<span class="sd">        !!! Note</span>
<span class="sd">            We highle recommend using the `transforms` arguments with at</span>
<span class="sd">            least the re-oriented transform to RAS and the intensity scaling</span>
<span class="sd">            to `[0, 1]` to ensure the data consistency.</span>

<span class="sd">            See [inference.yaml](https://github.com/Medical-Image-Analysis-Laboratory/fetalsyngen/blob/dev/configs/dataset/transforms/inference.yaml) for an example of the transforms configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="c1"># load the image and segmentation</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">segm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segm_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># add channel dimension</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">segm</span> <span class="o">=</span> <span class="n">segm</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected 3D or 4D image, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="si">}</span><span class="s2">D image.&quot;</span><span class="p">)</span>

        <span class="c1"># transform name into a single string otherwise collate fails</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ses</span><span class="o">=</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">segm</span><span class="o">.</span><span class="n">long</span><span class="p">(),</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with the `image` , `label` and the `name`</span>
<span class="sd">                keys. `image` and `label` are  `torch.float32`</span>
<span class="sd">                [`monai.data.meta_tensor.MetaTensor`](https://docs.monai.io/en/stable/data.html#metatensor)</span>
<span class="sd">                instances  with dimensions `(1, H, W, D)` and `name` is a string</span>
<span class="sd">                of a format `sub_ses` where `sub` is the subject name</span>
<span class="sd">                and `ses` is the session name.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reverse the transformations applied to the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Dictionary with the `image` and `label` keys,</span>
<span class="sd">                like the one returned by the `__getitem__` method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with the `image` and `label` keys where</span>
<span class="sd">                the transformations are reversed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalTestDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">,</span> <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bids_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the bids folder with the data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sub_list</code>
            </td>
            <td>
                  <code>list[str] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of the subjects to use. If None, all subjects are used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transforms</code>
            </td>
            <td>
                  <code><span title="monai.transforms.Compose">Compose</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compose object with the transformations to apply.
Default is None, no transformations are applied.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <div class="admonition note">
<p class="admonition-title">Note</p>
<p>We highle recommend using the <code>transforms</code> arguments with at
least the re-oriented transform to RAS and the intensity scaling
to <code>[0, 1]</code> to ensure the data consistency.</p>
<p>See <a href="https://github.com/Medical-Image-Analysis-Laboratory/fetalsyngen/blob/dev/configs/dataset/transforms/inference.yaml">inference.yaml</a> for an example of the transforms configuration.</p>
</div>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bids_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sub_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">transforms</span><span class="p">:</span> <span class="n">Compose</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        bids_path: Path to the bids folder with the data.</span>
<span class="sd">        sub_list: List of the subjects to use. If None, all subjects are used.</span>
<span class="sd">        transforms: Compose object with the transformations to apply.</span>
<span class="sd">            Default is None, no transformations are applied.</span>

<span class="sd">    !!! Note</span>
<span class="sd">        We highle recommend using the `transforms` arguments with at</span>
<span class="sd">        least the re-oriented transform to RAS and the intensity scaling</span>
<span class="sd">        to `[0, 1]` to ensure the data consistency.</span>

<span class="sd">        See [inference.yaml](https://github.com/Medical-Image-Analysis-Laboratory/fetalsyngen/blob/dev/configs/dataset/transforms/inference.yaml) for an example of the transforms configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalTestDataset.__getitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with the <code>image</code> , <code>label</code> and the <code>name</code>
keys. <code>image</code> and <code>label</code> are  <code>torch.float32</code>
<a href="https://docs.monai.io/en/stable/data.html#metatensor"><code>monai.data.meta_tensor.MetaTensor</code></a>
instances  with dimensions <code>(1, H, W, D)</code> and <code>name</code> is a string
of a format <code>sub_ses</code> where <code>sub</code> is the subject name
and <code>ses</code> is the session name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the `image` , `label` and the `name`</span>
<span class="sd">            keys. `image` and `label` are  `torch.float32`</span>
<span class="sd">            [`monai.data.meta_tensor.MetaTensor`](https://docs.monai.io/en/stable/data.html#metatensor)</span>
<span class="sd">            instances  with dimensions `(1, H, W, D)` and `name` is a string</span>
<span class="sd">            of a format `sub_ses` where `sub` is the subject name</span>
<span class="sd">            and `ses` is the session name.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalTestDataset.reverse_transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reverse_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reverse the transformations applied to the data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with the <code>image</code> and <code>label</code> keys,
like the one returned by the <code>__getitem__</code> method.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with the <code>image</code> and <code>label</code> keys where
the transformations are reversed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reverse the transformations applied to the data.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: Dictionary with the `image` and `label` keys,</span>
<span class="sd">            like the one returned by the `__getitem__` method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the `image` and `label` keys where</span>
<span class="sd">            the transformations are reversed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fetalsyngen.data.datasets.FetalSynthDataset" class="doc doc-heading">
            <code>FetalSynthDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="fetalsyngen.data.datasets.FetalDataset" href="#fetalsyngen.data.datasets.FetalDataset">FetalDataset</a></code></p>


        <p>Dataset class for generating/augmenting on-the-fly fetal images"</p>






              <details class="quote">
                <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FetalSynthDataset</span><span class="p">(</span><span class="n">FetalDataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataset class for generating/augmenting on-the-fly fetal images&quot; &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bids_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">generator</span><span class="p">:</span> <span class="n">FetalSynthGen</span><span class="p">,</span>
        <span class="n">seed_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sub_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">load_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">image_as_intensity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">transforms</span><span class="p">:</span> <span class="n">Compose</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            bids_path: Path to the bids-formatted folder with the data.</span>
<span class="sd">            seed_path: Path to the folder with the seeds to use for</span>
<span class="sd">                intensity sampling. See `scripts/seed_generation.py`</span>
<span class="sd">                for details on the data formatting. If seed_path is None,</span>
<span class="sd">                the intensity  sampling step is skipped and the output image</span>
<span class="sd">                intensities will be based on the input image.</span>
<span class="sd">            generator: a class object defining a generator to use.</span>
<span class="sd">            sub_list: List of the subjects to use. If None, all subjects are used.</span>
<span class="sd">            load_image: If **True**, the image is loaded and passed to the generator,</span>
<span class="sd">                where it can be used as the intensity prior instead of a random</span>
<span class="sd">                intensity sampling or spatially deformed with the same transformation</span>
<span class="sd">                field as segmentation and the syntehtic image. Default is **False**.</span>
<span class="sd">            image_as_intensity: If **True**, the image is used as the intensity prior,</span>
<span class="sd">                instead of sampling the intensities from the seeds. Default is **False**.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">seed_path</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span> <span class="o">=</span> <span class="n">load_image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">generator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_as_intensity</span> <span class="o">=</span> <span class="n">image_as_intensity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span>
        <span class="c1"># parse seeds paths</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_as_intensity</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Provided seed path </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_load_seed_path</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_seed_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the seeds for the subjects.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed_paths</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">):</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span>
        <span class="p">}</span>
        <span class="n">avail_seeds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;subclasses_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;subclasses_*&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">min_seeds_available</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">avail_seeds</span><span class="p">)</span>
        <span class="n">max_seeds_available</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">avail_seeds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="n">min_seeds_available</span><span class="p">,</span>
            <span class="n">max_seeds_available</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">seed_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;subclasses_</span><span class="si">{</span><span class="n">n_sub</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">seed_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Provided seed path </span><span class="si">{</span><span class="n">seed_path</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># load the seeds for the subjects for each meta label 1-4</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">intensity_generator</span><span class="o">.</span><span class="n">meta_labels</span><span class="p">:</span>
                <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bids_path</span><span class="p">(</span><span class="n">seed_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;mlabel_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">),</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
                    <span class="n">sub_ses_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">seed_paths</span><span class="p">[</span><span class="n">sub_ses_str</span><span class="p">][</span><span class="n">n_sub</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a single item from the dataset at the specified index.</span>

<span class="sd">        Args:</span>
<span class="sd">            idx (int): The index of the item to retrieve.</span>
<span class="sd">            genparams (dict): Dictionary with generation parameters.</span>
<span class="sd">                Used for fixed generation. Should follow exactly the same structure</span>
<span class="sd">                and be of the same type as the returned generation parameters.</span>
<span class="sd">                Can be used to replicate the augmentations (power)</span>
<span class="sd">                used for the generation of a specific sample.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Dictionaries with the generated data and the generation parameters.</span>
<span class="sd">                First dictionary contains the `image`, `label` and the `name` keys.</span>
<span class="sd">                The second dictionary contains the parameters used for the generation.</span>

<span class="sd">        !!! Note</span>
<span class="sd">            The `image` is scaled to `[0, 1]` and oriented with the `label` to **RAS**</span>
<span class="sd">            and returned on the device  specified in the `generator` initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># use generation_params to track the parameters used for the generation</span>
        <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">image</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">spatial_size</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">1.0</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">segm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">segm_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span> <span class="n">spatial_size</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="p">)</span>

        <span class="c1"># RANDOM re-orient TODO: MAKE SWTICHABLE!</span>
        <span class="c1"># LR = &quot;L&quot; if torch.rand(1) &gt; 0.5 else &quot;R&quot;</span>
        <span class="c1"># AP = &quot;A&quot; if torch.rand(1) &gt; 0.5 else &quot;P&quot;</span>
        <span class="c1"># IS = &quot;I&quot; if torch.rand(1) &gt; 0.5 else &quot;S&quot;</span>
        <span class="c1"># orient = np.array([LR, AP, IS])</span>
        <span class="c1"># rand_orient_oreder = torch.randperm(3)</span>
        <span class="n">axcodes</span> <span class="o">=</span> <span class="s2">&quot;RAS&quot;</span>  <span class="c1"># = orient[rand_orient_oreder]</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="n">Orientation</span><span class="p">(</span><span class="n">axcodes</span><span class="o">=</span><span class="n">axcodes</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">orientation</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">segm</span> <span class="o">=</span> <span class="n">orientation</span><span class="p">(</span><span class="n">segm</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># transform name into a single string otherwise collate fails</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ses</span><span class="o">=</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># initialize seeds as dictionary</span>
        <span class="c1"># with paths to the seeds volumes</span>
        <span class="c1"># or None if image is to be used as intensity prior</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_paths</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_as_intensity</span><span class="p">:</span>
            <span class="n">seeds</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># log input data</span>
        <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;img_paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;segm_paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;seeds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="p">)</span>
        <span class="n">generation_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># generate the synthetic data</span>
        <span class="n">gen_output</span><span class="p">,</span> <span class="n">segmentation</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">synth_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
            <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
            <span class="n">segmentation</span><span class="o">=</span><span class="n">segm</span><span class="p">,</span>
            <span class="n">seeds</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span>
            <span class="n">genparams</span><span class="o">=</span><span class="n">genparams</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># scale the images to [0, 1]</span>
        <span class="n">gen_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="p">(</span><span class="n">gen_output</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># ensure image and segmentation are on the cpu</span>
        <span class="n">gen_output</span> <span class="o">=</span> <span class="n">gen_output</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">segmentation</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span> <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">generation_params</span><span class="p">,</span> <span class="o">**</span><span class="n">synth_params</span><span class="p">}</span>
        <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;generation_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">generation_time_start</span>
        <span class="n">data_out</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">gen_output</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="n">data_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">(</span><span class="n">data_out</span><span class="p">)</span>
        <span class="n">data_out</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">return</span> <span class="n">data_out</span><span class="p">,</span> <span class="n">generation_params</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a single item from the dataset at the specified index.</span>

<span class="sd">        Args:</span>
<span class="sd">            idx (int): The index of the item to retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with the `image`, `label` and the `name` keys.</span>
<span class="sd">                `image` and `label` are `torch.float32`</span>
<span class="sd">                [`monai.data.meta_tensor.MetaTensor`](https://docs.monai.io/en/stable/data.html#metatensor)</span>
<span class="sd">                and `name` is a string of a format `sub_ses` where `sub` is the subject name</span>
<span class="sd">                and `ses` is the session name.</span>

<span class="sd">        !!!Note</span>
<span class="sd">            The `image` is scaled to `[0, 1]` and oriented to **RAS** and returned on the device</span>
<span class="sd">            specified in the `generator` initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_out</span><span class="p">,</span> <span class="n">generation_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generation_params</span> <span class="o">=</span> <span class="n">generation_params</span>
        <span class="k">return</span> <span class="n">data_out</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_with_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">genparams</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a sample along with its generation parameters</span>
<span class="sd">        and store them in the same dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            idx: The index of the sample to retrieve.</span>
<span class="sd">            genparams: Dictionary with generation parameters.</span>
<span class="sd">                Used for fixed generation. Should follow exactly the same structure</span>
<span class="sd">                and be of the same type as the returned generation parameters from the `sample()` method.</span>
<span class="sd">                Can be used to replicate the augmentations (power)</span>
<span class="sd">                used for the generation of a specific sample.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with `image`, `label`, `name` and `generation_params` keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">generation_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="n">genparams</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;generation_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generation_params</span>
        <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">seed_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">,</span> <span class="n">load_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">image_as_intensity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bids_path</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the bids-formatted folder with the data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seed_path</code>
            </td>
            <td>
                  <code>str | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the folder with the seeds to use for
intensity sampling. See <code>scripts/seed_generation.py</code>
for details on the data formatting. If seed_path is None,
the intensity  sampling step is skipped and the output image
intensities will be based on the input image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>generator</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="fetalsyngen.generator.model.FetalSynthGen" href="../generation/#fetalsyngen.generator.model.FetalSynthGen">FetalSynthGen</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a class object defining a generator to use.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sub_list</code>
            </td>
            <td>
                  <code>list[str] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of the subjects to use. If None, all subjects are used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load_image</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <strong>True</strong>, the image is loaded and passed to the generator,
where it can be used as the intensity prior instead of a random
intensity sampling or spatially deformed with the same transformation
field as segmentation and the syntehtic image. Default is <strong>False</strong>.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_as_intensity</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <strong>True</strong>, the image is used as the intensity prior,
instead of sampling the intensities from the seeds. Default is <strong>False</strong>.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bids_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">generator</span><span class="p">:</span> <span class="n">FetalSynthGen</span><span class="p">,</span>
    <span class="n">seed_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sub_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">load_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">image_as_intensity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">transforms</span><span class="p">:</span> <span class="n">Compose</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        bids_path: Path to the bids-formatted folder with the data.</span>
<span class="sd">        seed_path: Path to the folder with the seeds to use for</span>
<span class="sd">            intensity sampling. See `scripts/seed_generation.py`</span>
<span class="sd">            for details on the data formatting. If seed_path is None,</span>
<span class="sd">            the intensity  sampling step is skipped and the output image</span>
<span class="sd">            intensities will be based on the input image.</span>
<span class="sd">        generator: a class object defining a generator to use.</span>
<span class="sd">        sub_list: List of the subjects to use. If None, all subjects are used.</span>
<span class="sd">        load_image: If **True**, the image is loaded and passed to the generator,</span>
<span class="sd">            where it can be used as the intensity prior instead of a random</span>
<span class="sd">            intensity sampling or spatially deformed with the same transformation</span>
<span class="sd">            field as segmentation and the syntehtic image. Default is **False**.</span>
<span class="sd">        image_as_intensity: If **True**, the image is used as the intensity prior,</span>
<span class="sd">            instead of sampling the intensities from the seeds. Default is **False**.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">seed_path</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span> <span class="o">=</span> <span class="n">load_image</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">generator</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">image_as_intensity</span> <span class="o">=</span> <span class="n">image_as_intensity</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span>
    <span class="c1"># parse seeds paths</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_as_intensity</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provided seed path </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_seed_path</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset.sample" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="p">{})</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieve a single item from the dataset at the specified index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the item to retrieve.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>genparams</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with generation parameters.
Used for fixed generation. Should follow exactly the same structure
and be of the same type as the returned generation parameters.
Can be used to replicate the augmentations (power)
used for the generation of a specific sample.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    Dictionaries with the generated data and the generation parameters.
        First dictionary contains the <code>image</code>, <code>label</code> and the <code>name</code> keys.
        The second dictionary contains the parameters used for the generation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>image</code> is scaled to <code>[0, 1]</code> and oriented with the <code>label</code> to <strong>RAS</strong>
and returned on the device  specified in the <code>generator</code> initialization.</p>
</div>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a single item from the dataset at the specified index.</span>

<span class="sd">    Args:</span>
<span class="sd">        idx (int): The index of the item to retrieve.</span>
<span class="sd">        genparams (dict): Dictionary with generation parameters.</span>
<span class="sd">            Used for fixed generation. Should follow exactly the same structure</span>
<span class="sd">            and be of the same type as the returned generation parameters.</span>
<span class="sd">            Can be used to replicate the augmentations (power)</span>
<span class="sd">            used for the generation of a specific sample.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Dictionaries with the generated data and the generation parameters.</span>
<span class="sd">            First dictionary contains the `image`, `label` and the `name` keys.</span>
<span class="sd">            The second dictionary contains the parameters used for the generation.</span>

<span class="sd">    !!! Note</span>
<span class="sd">        The `image` is scaled to `[0, 1]` and oriented with the `label` to **RAS**</span>
<span class="sd">        and returned on the device  specified in the `generator` initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># use generation_params to track the parameters used for the generation</span>
    <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">image</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">spatial_size</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="n">segm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segm_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span> <span class="n">spatial_size</span><span class="o">=</span><span class="mi">192</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="p">)</span>

    <span class="c1"># RANDOM re-orient TODO: MAKE SWTICHABLE!</span>
    <span class="c1"># LR = &quot;L&quot; if torch.rand(1) &gt; 0.5 else &quot;R&quot;</span>
    <span class="c1"># AP = &quot;A&quot; if torch.rand(1) &gt; 0.5 else &quot;P&quot;</span>
    <span class="c1"># IS = &quot;I&quot; if torch.rand(1) &gt; 0.5 else &quot;S&quot;</span>
    <span class="c1"># orient = np.array([LR, AP, IS])</span>
    <span class="c1"># rand_orient_oreder = torch.randperm(3)</span>
    <span class="n">axcodes</span> <span class="o">=</span> <span class="s2">&quot;RAS&quot;</span>  <span class="c1"># = orient[rand_orient_oreder]</span>
    <span class="n">orientation</span> <span class="o">=</span> <span class="n">Orientation</span><span class="p">(</span><span class="n">axcodes</span><span class="o">=</span><span class="n">axcodes</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">orientation</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">segm</span> <span class="o">=</span> <span class="n">orientation</span><span class="p">(</span><span class="n">segm</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># transform name into a single string otherwise collate fails</span>
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ses</span><span class="o">=</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># initialize seeds as dictionary</span>
    <span class="c1"># with paths to the seeds volumes</span>
    <span class="c1"># or None if image is to be used as intensity prior</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">seeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_paths</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_as_intensity</span><span class="p">:</span>
        <span class="n">seeds</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># log input data</span>
    <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
    <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;img_paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;segm_paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;seeds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="p">)</span>
    <span class="n">generation_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># generate the synthetic data</span>
    <span class="n">gen_output</span><span class="p">,</span> <span class="n">segmentation</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">synth_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
        <span class="n">segmentation</span><span class="o">=</span><span class="n">segm</span><span class="p">,</span>
        <span class="n">seeds</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span>
        <span class="n">genparams</span><span class="o">=</span><span class="n">genparams</span><span class="p">,</span>
        <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># scale the images to [0, 1]</span>
    <span class="n">gen_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="p">(</span><span class="n">gen_output</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="c1"># ensure image and segmentation are on the cpu</span>
    <span class="n">gen_output</span> <span class="o">=</span> <span class="n">gen_output</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
    <span class="n">segmentation</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span> <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">generation_params</span><span class="p">,</span> <span class="o">**</span><span class="n">synth_params</span><span class="p">}</span>
    <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;generation_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">generation_time_start</span>
    <span class="n">data_out</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">gen_output</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">(),</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
        <span class="n">data_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">(</span><span class="n">data_out</span><span class="p">)</span>
    <span class="n">data_out</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">return</span> <span class="n">data_out</span><span class="p">,</span> <span class="n">generation_params</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset.__getitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieve a single item from the dataset at the specified index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the item to retrieve.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with the <code>image</code>, <code>label</code> and the <code>name</code> keys.
<code>image</code> and <code>label</code> are <code>torch.float32</code>
<a href="https://docs.monai.io/en/stable/data.html#metatensor"><code>monai.data.meta_tensor.MetaTensor</code></a>
and <code>name</code> is a string of a format <code>sub_ses</code> where <code>sub</code> is the subject name
and <code>ses</code> is the session name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>image</code> is scaled to <code>[0, 1]</code> and oriented to <strong>RAS</strong> and returned on the device
specified in the <code>generator</code> initialization.</p>
</div>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a single item from the dataset at the specified index.</span>

<span class="sd">    Args:</span>
<span class="sd">        idx (int): The index of the item to retrieve.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the `image`, `label` and the `name` keys.</span>
<span class="sd">            `image` and `label` are `torch.float32`</span>
<span class="sd">            [`monai.data.meta_tensor.MetaTensor`](https://docs.monai.io/en/stable/data.html#metatensor)</span>
<span class="sd">            and `name` is a string of a format `sub_ses` where `sub` is the subject name</span>
<span class="sd">            and `ses` is the session name.</span>

<span class="sd">    !!!Note</span>
<span class="sd">        The `image` is scaled to `[0, 1]` and oriented to **RAS** and returned on the device</span>
<span class="sd">        specified in the `generator` initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_out</span><span class="p">,</span> <span class="n">generation_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generation_params</span> <span class="o">=</span> <span class="n">generation_params</span>
    <span class="k">return</span> <span class="n">data_out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_with_meta</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="p">{})</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieve a sample along with its generation parameters
and store them in the same dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of the sample to retrieve.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>genparams</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with generation parameters.
Used for fixed generation. Should follow exactly the same structure
and be of the same type as the returned generation parameters from the <code>sample()</code> method.
Can be used to replicate the augmentations (power)
used for the generation of a specific sample.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with <code>image</code>, <code>label</code>, <code>name</code> and <code>generation_params</code> keys.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_with_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">genparams</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a sample along with its generation parameters</span>
<span class="sd">    and store them in the same dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        idx: The index of the sample to retrieve.</span>
<span class="sd">        genparams: Dictionary with generation parameters.</span>
<span class="sd">            Used for fixed generation. Should follow exactly the same structure</span>
<span class="sd">            and be of the same type as the returned generation parameters from the `sample()` method.</span>
<span class="sd">            Can be used to replicate the augmentations (power)</span>
<span class="sd">            used for the generation of a specific sample.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary with `image`, `label`, `name` and `generation_params` keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">,</span> <span class="n">generation_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="n">genparams</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;generation_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generation_params</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="fixed-image-generation">Fixed Image Generation</h2>
<p>It is possible to generate synthetic images of the same 'augmentation' power as any given synthetic image. This is done by passing the <code>genparams</code> dictionary to the <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta"><code>sample_with_meta</code></a> (or <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample"><code>sample</code></a>) method of the <a href="#fetalsyngen.data.datasets.FetalSynthDataset"><code>FetalSynthDataset</code></a> class. The <code>generation_params</code> dictionary is a dictionary of the parameters used to generate the image. The method will then use these parameters to generate a new image with the same <code>augmentation power</code> as the original image.</p>
<p>This <code>genparams</code> dictionary can be obtained, for example, from the dictionary returned by the <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta"><code>FetalSynthDataset.sample_with_meta</code></a>  method. It then can be directly used to <code>fix</code> (some or all) generation parameters for the new image.</p>
<p>See example below:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># initialize the dataset class</span>
<span class="c1"># see the Examples page for more details</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">FetalSynthDataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># first sample a synthetic image from the dataset</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">sample_with_meta</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># then we sample a synthetic image with the same augmentation power as the first image</span>
<span class="n">sample_copy</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">sample_with_meta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;generation_params&quot;</span><span class="p">])</span>
</code></pre></div>
<p>For example, generation parameters of the first image can be like this:</p>
<details>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;idx&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;img_paths&#39;</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/sub-sta38/anat/sub-sta38_rec-irtk_T2w.nii.gz&#39;</span><span class="p">),</span>
 <span class="s1">&#39;segm_paths&#39;</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/sub-sta38/anat/sub-sta38_rec-irtk_T2w.nii.gz&#39;</span><span class="p">),</span>
 <span class="s1">&#39;seeds&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">2</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">3</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">4</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz&#39;</span><span class="p">)},</span>
              <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">2</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">3</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">4</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz&#39;</span><span class="p">)},</span>
              <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">2</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">3</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">4</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz&#39;</span><span class="p">)}}),</span>
 <span class="s1">&#39;selected_seeds&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mlabel2subclusters&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
 <span class="s1">&#39;seed_intensities&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mus&#39;</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">109.6722</span><span class="p">,</span> <span class="mf">220.9658</span><span class="p">,</span> <span class="mf">100.9801</span><span class="p">,</span>  <span class="mf">38.6364</span><span class="p">,</span> <span class="mf">125.5148</span><span class="p">,</span> <span class="mf">108.1950</span><span class="p">,</span> <span class="mf">216.1060</span><span class="p">,</span>
          <span class="mf">190.5462</span><span class="p">,</span>  <span class="mf">55.3930</span><span class="p">,</span>  <span class="mf">59.2667</span><span class="p">,</span>  <span class="mf">72.0628</span><span class="p">,</span>  <span class="mf">68.8775</span><span class="p">,</span>  <span class="mf">76.5113</span><span class="p">,</span>  <span class="mf">84.6639</span><span class="p">,</span>
           <span class="mf">90.0124</span><span class="p">,</span>  <span class="mf">94.1701</span><span class="p">,</span>  <span class="mf">67.0610</span><span class="p">,</span>  <span class="mf">25.9465</span><span class="p">,</span>  <span class="mf">31.5438</span><span class="p">,</span>  <span class="mf">21.0375</span><span class="p">,</span> <span class="mf">192.4223</span><span class="p">,</span>
          <span class="mf">173.7434</span><span class="p">,</span> <span class="mf">139.9284</span><span class="p">,</span> <span class="mf">121.3904</span><span class="p">,</span> <span class="mf">145.4289</span><span class="p">,</span> <span class="mf">158.1318</span><span class="p">,</span> <span class="mf">157.4630</span><span class="p">,</span> <span class="mf">150.0894</span><span class="p">,</span>
          <span class="mf">183.9047</span><span class="p">,</span> <span class="mf">181.7129</span><span class="p">,</span> <span class="mf">114.8939</span><span class="p">,</span>   <span class="mf">9.5253</span><span class="p">,</span>  <span class="mf">29.0257</span><span class="p">,</span>  <span class="mf">97.9543</span><span class="p">,</span> <span class="mf">122.0798</span><span class="p">,</span>
           <span class="mf">72.2969</span><span class="p">,</span>  <span class="mf">26.3086</span><span class="p">,</span>  <span class="mf">81.8050</span><span class="p">,</span>  <span class="mf">67.7463</span><span class="p">,</span>  <span class="mf">72.3737</span><span class="p">,</span> <span class="mf">129.8539</span><span class="p">,</span> <span class="mf">113.3900</span><span class="p">,</span>
          <span class="mf">141.8177</span><span class="p">,</span> <span class="mf">225.0000</span><span class="p">,</span>  <span class="mf">35.3458</span><span class="p">,</span> <span class="mf">173.7635</span><span class="p">,</span>  <span class="mf">29.5101</span><span class="p">,</span> <span class="mf">135.9482</span><span class="p">,</span> <span class="mf">188.2391</span><span class="p">,</span>
          <span class="mf">225.0000</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">),</span>
  <span class="s1">&#39;sigmas&#39;</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span> <span class="mf">9.2432</span><span class="p">,</span> <span class="mf">23.1060</span><span class="p">,</span> <span class="mf">16.4965</span><span class="p">,</span>  <span class="mf">6.4289</span><span class="p">,</span> <span class="mf">24.7862</span><span class="p">,</span> <span class="mf">23.7996</span><span class="p">,</span> <span class="mf">15.2424</span><span class="p">,</span> <span class="mf">20.2845</span><span class="p">,</span>
          <span class="mf">12.6833</span><span class="p">,</span>  <span class="mf">6.9079</span><span class="p">,</span>  <span class="mf">6.1214</span><span class="p">,</span> <span class="mf">22.1317</span><span class="p">,</span>  <span class="mf">9.7907</span><span class="p">,</span>  <span class="mf">5.5302</span><span class="p">,</span> <span class="mf">14.3288</span><span class="p">,</span> <span class="mf">11.1454</span><span class="p">,</span>
          <span class="mf">16.0453</span><span class="p">,</span> <span class="mf">20.9057</span><span class="p">,</span> <span class="mf">24.2358</span><span class="p">,</span> <span class="mf">13.4785</span><span class="p">,</span> <span class="mf">22.7258</span><span class="p">,</span> <span class="mf">11.2053</span><span class="p">,</span> <span class="mf">12.9420</span><span class="p">,</span> <span class="mf">13.4270</span><span class="p">,</span>
          <span class="mf">14.8660</span><span class="p">,</span> <span class="mf">22.4874</span><span class="p">,</span>  <span class="mf">5.6251</span><span class="p">,</span>  <span class="mf">9.8794</span><span class="p">,</span>  <span class="mf">8.8749</span><span class="p">,</span> <span class="mf">19.0294</span><span class="p">,</span>  <span class="mf">9.7164</span><span class="p">,</span>  <span class="mf">6.2293</span><span class="p">,</span>
          <span class="mf">13.6376</span><span class="p">,</span> <span class="mf">11.7447</span><span class="p">,</span> <span class="mf">14.1414</span><span class="p">,</span>  <span class="mf">6.4362</span><span class="p">,</span> <span class="mf">20.4575</span><span class="p">,</span> <span class="mf">14.6729</span><span class="p">,</span>  <span class="mf">8.4719</span><span class="p">,</span> <span class="mf">14.2926</span><span class="p">,</span>
           <span class="mf">6.9458</span><span class="p">,</span> <span class="mf">11.5346</span><span class="p">,</span> <span class="mf">14.6113</span><span class="p">,</span>  <span class="mf">6.6516</span><span class="p">,</span> <span class="mf">22.1767</span><span class="p">,</span>  <span class="mf">8.3793</span><span class="p">,</span> <span class="mf">20.1699</span><span class="p">,</span>  <span class="mf">6.3299</span><span class="p">,</span>
           <span class="mf">5.3340</span><span class="p">,</span> <span class="mf">21.8027</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">)},</span>
 <span class="s1">&#39;deform_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;affine&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;rotations&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.0008224</span> <span class="p">,</span>  <span class="mf">0.03067143</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0151502</span> <span class="p">]),</span>
   <span class="s1">&#39;shears&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01735838</span><span class="p">,</span>  <span class="mf">0.00744726</span><span class="p">,</span>  <span class="mf">0.00012507</span><span class="p">]),</span>
   <span class="s1">&#39;scalings&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">1.09345725</span><span class="p">,</span> <span class="mf">0.91695532</span><span class="p">,</span> <span class="mf">0.98194215</span><span class="p">])},</span>
  <span class="s1">&#39;non_rigid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;nonlin_scale&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.05686841</span><span class="p">]),</span>
   <span class="s1">&#39;nonlin_std&#39;</span><span class="p">:</span> <span class="mf">1.048839010036788</span><span class="p">,</span>
   <span class="s1">&#39;size_F_small&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">]},</span>
  <span class="s1">&#39;flip&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
 <span class="s1">&#39;gamma_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">0.960299468352801</span><span class="p">},</span>
 <span class="s1">&#39;bf_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;bf_scale&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;bf_std&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;bf_size&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
 <span class="s1">&#39;resample_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;spacing&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.65685245</span><span class="p">,</span> <span class="mf">0.65685245</span><span class="p">,</span> <span class="mf">0.65685245</span><span class="p">])},</span>
 <span class="s1">&#39;noise_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;noise_std&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
 <span class="s1">&#39;generation_time&#39;</span><span class="p">:</span> <span class="mf">0.5615839958190918</span><span class="p">}</span>
</code></pre></div>
</details>

<p><br>
If the <code>key:value</code> pair exists in the passed <code>genparams</code> dictionary, the <code>sample</code> method will use directly the value from the <code>genparams</code> dictionary. If the <code>key:value</code> pair does not exist in the <code>genparams</code> dictionary or it is <code>None</code>,  <code>sample</code> method will generate the value randomly, using the corresponding class attributes.</p>
<p>See how the keys <code>bf_scale</code>, <code>bf_std</code>, <code>bf_size</code> and <code>noise_std</code> have not been defined in the <code>genparams</code> dictionary above. This means that the <code>sample</code> method will generate these values randomly. The same could have been achieved by not passing them at all.</p>
<details>
    {'idx': 0,
    'img_paths': PosixPath('../data/sub-sta38/anat/sub-sta38_rec-irtk_T2w.nii.gz'),
    'segm_paths': PosixPath('../data/sub-sta38/anat/sub-sta38_rec-irtk_T2w.nii.gz'),
    'seeds': defaultdict(dict,
                {1: {1: PosixPath('../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz'),
                2: PosixPath('../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz'),
                3: PosixPath('../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz'),
                4: PosixPath('../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz')},
                2: {1: PosixPath('../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz'),
                2: PosixPath('../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz'),
                3: PosixPath('../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz'),
                4: PosixPath('../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz')},
                3: {1: PosixPath('../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz'),
                2: PosixPath('../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz'),
                3: PosixPath('../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz'),
                4: PosixPath('../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz')}}),
    'selected_seeds': {'mlabel2subclusters': {1: 2, 2: 1, 3: 3, 4: 1}},
    'seed_intensities': {'mus': tensor([109.6722, 220.9658, 100.9801,  38.6364, 125.5148, 108.1950, 216.1060,
            190.5462,  55.3930,  59.2667,  72.0628,  68.8775,  76.5113,  84.6639,
            90.0124,  94.1701,  67.0610,  25.9465,  31.5438,  21.0375, 192.4223,
            173.7434, 139.9284, 121.3904, 145.4289, 158.1318, 157.4630, 150.0894,
            183.9047, 181.7129, 114.8939,   9.5253,  29.0257,  97.9543, 122.0798,
            72.2969,  26.3086,  81.8050,  67.7463,  72.3737, 129.8539, 113.3900,
            141.8177, 225.0000,  35.3458, 173.7635,  29.5101, 135.9482, 188.2391,
            225.0000], device='cuda:0'),
    'sigmas': tensor([ 9.2432, 23.1060, 16.4965,  6.4289, 24.7862, 23.7996, 15.2424, 20.2845,
            12.6833,  6.9079,  6.1214, 22.1317,  9.7907,  5.5302, 14.3288, 11.1454,
            16.0453, 20.9057, 24.2358, 13.4785, 22.7258, 11.2053, 12.9420, 13.4270,
            14.8660, 22.4874,  5.6251,  9.8794,  8.8749, 19.0294,  9.7164,  6.2293,
            13.6376, 11.7447, 14.1414,  6.4362, 20.4575, 14.6729,  8.4719, 14.2926,
            6.9458, 11.5346, 14.6113,  6.6516, 22.1767,  8.3793, 20.1699,  6.3299,
            5.3340, 21.8027], device='cuda:0')},
    'deform_params': {'affine': {'rotations': array([ 0.0008224 ,  0.03067143, -0.0151502 ]),
    'shears': array([-0.01735838,  0.00744726,  0.00012507]),
    'scalings': array([1.09345725, 0.91695532, 0.98194215])},
    'non_rigid': {'nonlin_scale': array([0.05686841]),
    'nonlin_std': 1.048839010036788,
    'size_F_small': [15, 15, 15]},
    'flip': False},
    'gamma_params': {'gamma': 0.960299468352801},
    'bf_params': {'bf_scale': array([0.00797334]),
    'bf_std': array([0.21896995]),
    'bf_size': [2, 2, 2]},
    'resample_params': {'spacing': array([0.65685245, 0.65685245, 0.65685245])},
    'noise_params': {'noise_std': None},
    'generation_time': 0.6192283630371094}
    ```

</details>
<p><br></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>
<p>If a specific parameter is passed in <code>genparams</code> it means that the probability of its application is 100%. The internal <code>prob</code> is not used as the parameter is fixed.</p>
</li>
<li>
<p>If using custom values for the parameters, ensure that the values are within the range of the parameters defined in the class attributes (especially for the spatial deformation parameters, as the grid is pre-defined at class initialization). Furthermore, ensure that the device location and parameter type is consistent with the one in the returned generation_parameters dictionary.</p>
</li>
</ul>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "navigation.expand"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Datasets - FetalSynthGen</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Datasets";
        var mkdocs_page_input_path = "datasets.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../media/fetsynthgen_logo.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">FetalSynthGen GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../usage/">How to use the generator?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../seed_generation/">Seed Generation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configs/">Configs</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Datasets</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#fetalsyngen.data.datasets">datasets</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalDataset">FetalDataset</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalDataset.__init__">__init__</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalTestDataset">FetalTestDataset</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalTestDataset.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalTestDataset.__getitem__">__getitem__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalTestDataset.reverse_transform">reverse_transform</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalSynthDataset">FetalSynthDataset</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalSynthDataset.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalSynthDataset.sample">sample</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalSynthDataset.__getitem__">__getitem__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta">sample_with_meta</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixed-image-generation">Fixed Image Generation</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../generation/">Generation</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">FetalSynthGen</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API</li>
      <li class="breadcrumb-item active">Datasets</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="datasets">Datasets</h1>
<p>Classes for loading and processing datasets.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<blockquote>
<p><strong>üìù Device</strong>: All datasets return samples with tensors on the CPU (even when the synthetic data generation is done on the GPU). This is due to restriction on the GPU usage in the multiprocessing settings, where GPU memory cannot be easily shared between processes.</p>
<p><strong>üìù Dataloader</strong>: When using <code>torch.utils.data.DataLoader</code> ensure that you pass <code>multiprocessing_context="spawn"</code> argument to the dataloader object when using <code>FetalSynthDataset</code> to ensure that the spawned processes have access to the GPU.</p>
</blockquote>


<div class="doc doc-object doc-module">



<a id="fetalsyngen.data.datasets"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="fetalsyngen.data.datasets.FetalDataset" class="doc doc-heading">
            <code>FetalDataset</code>


</h2>


    <div class="doc doc-contents ">


        <p>Abstract class defining a dataset for loading fetal data.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bids_path</code></b>
                  (<code>str</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>Path to the bids folder with the data.</p>
              </div>
            </li>
            <li>
              <b><code>sub_list</code></b>
                  (<code>list[str] | None</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>List of the subjects to use. If None, all subjects are used.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fetalsyngen.data.datasets.FetalTestDataset" class="doc doc-heading">
            <code>FetalTestDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="fetalsyngen.data.datasets.FetalDataset" href="#fetalsyngen.data.datasets.FetalDataset">FetalDataset</a></code></p>


        <p>Dataset class for loading fetal images offline.
Used to load test/validation data.</p>
<p>Use the <code>transforms</code> argument to pass additional processing steps
(scaling, resampling, cropping, etc.).</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalTestDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">,</span> <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bids_path</code></b>
                  (<code>str</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>Path to the bids folder with the data.</p>
              </div>
            </li>
            <li>
              <b><code>sub_list</code></b>
                  (<code>list[str] | None</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>List of the subjects to use. If None, all subjects are used.</p>
              </div>
            </li>
            <li>
              <b><code>transforms</code></b>
                  (<code><span title="monai.transforms.Compose">Compose</span> | None</code>, default:
                      <code>None</code>
)
              ‚Äì
              <div class="doc-md-description">
                <p>Compose object with the transformations to apply.
Default is None, no transformations are applied.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <div class="admonition note">
<p class="admonition-title">Note</p>
<p>We highle recommend using the <code>transforms</code> arguments with at
least the re-oriented transform to RAS and the intensity scaling
to <code>[0, 1]</code> to ensure the data consistency.</p>
<p>See <a href="https://github.com/Medical-Image-Analysis-Laboratory/fetalsyngen/blob/dev/configs/dataset/transforms/inference.yaml">inference.yaml</a> for an example of the transforms configuration.</p>
</div>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalTestDataset.__getitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>dict</code>
              ‚Äì
              <div class="doc-md-description">
                <p>Dictionary with the <code>image</code> , <code>label</code> and the <code>name</code>
keys. <code>image</code> and <code>label</code> are  <code>torch.float32</code>
<a href="https://docs.monai.io/en/stable/data.html#metatensor"><code>monai.data.meta_tensor.MetaTensor</code></a>
instances  with dimensions <code>(1, H, W, D)</code> and <code>name</code> is a string
of a format <code>sub_ses</code> where <code>sub</code> is the subject name
and <code>ses</code> is the session name.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalTestDataset.reverse_transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reverse_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reverse the transformations applied to the data.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>data</code></b>
                  (<code>dict</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>Dictionary with the <code>image</code> and <code>label</code> keys,
like the one returned by the <code>__getitem__</code> method.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>dict</code>
              ‚Äì
              <div class="doc-md-description">
                <p>Dictionary with the <code>image</code> and <code>label</code> keys where
the transformations are reversed.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fetalsyngen.data.datasets.FetalSynthDataset" class="doc doc-heading">
            <code>FetalSynthDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="fetalsyngen.data.datasets.FetalDataset" href="#fetalsyngen.data.datasets.FetalDataset">FetalDataset</a></code></p>


        <p>Dataset class for generating/augmenting on-the-fly fetal images"</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">seed_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">,</span> <span class="n">load_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">image_as_intensity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bids_path</code></b>
                  (<code>str</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>Path to the bids-formatted folder with the data.</p>
              </div>
            </li>
            <li>
              <b><code>seed_path</code></b>
                  (<code>str | None</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>Path to the folder with the seeds to use for
intensity sampling. See <code>scripts/seed_generation.py</code>
for details on the data formatting. If seed_path is None,
the intensity  sampling step is skipped and the output image
intensities will be based on the input image.</p>
              </div>
            </li>
            <li>
              <b><code>generator</code></b>
                  (<code><a class="autorefs autorefs-internal" title="fetalsyngen.generator.model.FetalSynthGen" href="../generation/#fetalsyngen.generator.model.FetalSynthGen">FetalSynthGen</a></code>)
              ‚Äì
              <div class="doc-md-description">
                <p>a class object defining a generator to use.</p>
              </div>
            </li>
            <li>
              <b><code>sub_list</code></b>
                  (<code>list[str] | None</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>List of the subjects to use. If None, all subjects are used.</p>
              </div>
            </li>
            <li>
              <b><code>load_image</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              ‚Äì
              <div class="doc-md-description">
                <p>If <strong>True</strong>, the image is loaded and passed to the generator,
where it can be used as the intensity prior instead of a random
intensity sampling or spatially deformed with the same transformation
field as segmentation and the syntehtic image. Default is <strong>False</strong>.</p>
              </div>
            </li>
            <li>
              <b><code>image_as_intensity</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              ‚Äì
              <div class="doc-md-description">
                <p>If <strong>True</strong>, the image is used as the intensity prior,
instead of sampling the intensities from the seeds. Default is <strong>False</strong>.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset.sample" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="p">{})</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieve a single item from the dataset at the specified index.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>idx</code></b>
                  (<code>int</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>The index of the item to retrieve.</p>
              </div>
            </li>
            <li>
              <b><code>genparams</code></b>
                  (<code>dict</code>, default:
                      <code>{}</code>
)
              ‚Äì
              <div class="doc-md-description">
                <p>Dictionary with generation parameters.
Used for fixed generation. Should follow exactly the same structure
and be of the same type as the returned generation parameters.
Can be used to replicate the augmentations (power)
used for the generation of a specific sample.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
    Dictionaries with the generated data and the generation parameters.
        First dictionary contains the <code>image</code>, <code>label</code> and the <code>name</code> keys.
        The second dictionary contains the parameters used for the generation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>image</code> is scaled to <code>[0, 1]</code> and oriented with the <code>label</code> to <strong>RAS</strong>
and returned on the device  specified in the <code>generator</code> initialization.</p>
</div>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset.__getitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieve a single item from the dataset at the specified index.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>idx</code></b>
                  (<code>int</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>The index of the item to retrieve.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>dict</code>
              ‚Äì
              <div class="doc-md-description">
                <p>Dictionary with the <code>image</code>, <code>label</code> and the <code>name</code> keys.
<code>image</code> and <code>label</code> are <code>torch.float32</code>
<a href="https://docs.monai.io/en/stable/data.html#metatensor"><code>monai.data.meta_tensor.MetaTensor</code></a>
and <code>name</code> is a string of a format <code>sub_ses</code> where <code>sub</code> is the subject name
and <code>ses</code> is the session name.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>image</code> is scaled to <code>[0, 1]</code> and oriented to <strong>RAS</strong> and returned on the device
specified in the <code>generator</code> initialization.</p>
</div>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_with_meta</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="p">{})</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieve a sample along with its generation parameters
and store them in the same dictionary.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>idx</code></b>
                  (<code>int</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>The index of the sample to retrieve.</p>
              </div>
            </li>
            <li>
              <b><code>genparams</code></b>
                  (<code>dict</code>, default:
                      <code>{}</code>
)
              ‚Äì
              <div class="doc-md-description">
                <p>Dictionary with generation parameters.
Used for fixed generation. Should follow exactly the same structure
and be of the same type as the returned generation parameters from the <code>sample()</code> method.
Can be used to replicate the augmentations (power)
used for the generation of a specific sample.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code>dict</code>
              ‚Äì
              <div class="doc-md-description">
                <p>A dictionary with <code>image</code>, <code>label</code>, <code>name</code> and <code>generation_params</code> keys.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="fixed-image-generation">Fixed Image Generation</h2>
<p>It is possible to generate synthetic images of the same 'augmentation' power as any given synthetic image. This is done by passing the <code>genparams</code> dictionary to the <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta"><code>sample_with_meta</code></a> (or <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample"><code>sample</code></a>) method of the <a href="#fetalsyngen.data.datasets.FetalSynthDataset"><code>FetalSynthDataset</code></a> class. The <code>generation_params</code> dictionary is a dictionary of the parameters used to generate the image. The method will then use these parameters to generate a new image with the same <code>augmentation power</code> as the original image.</p>
<p>This <code>genparams</code> dictionary can be obtained, for example, from the dictionary returned by the <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta"><code>FetalSynthDataset.sample_with_meta</code></a>  method. It then can be directly used to <code>fix</code> (some or all) generation parameters for the new image.</p>
<p>See example below:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># initialize the dataset class</span>
<span class="c1"># see the Examples page for more details</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">FetalSynthDataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># first sample a synthetic image from the dataset</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">sample_with_meta</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># then we sample a synthetic image with the same augmentation power as the first image</span>
<span class="n">sample_copy</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">sample_with_meta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;generation_params&quot;</span><span class="p">])</span>
</code></pre></div>
<p>For example, generation parameters of the first image can be like this:</p>
<details>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;idx&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;img_paths&#39;</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/sub-sta38/anat/sub-sta38_rec-irtk_T2w.nii.gz&#39;</span><span class="p">),</span>
 <span class="s1">&#39;segm_paths&#39;</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/sub-sta38/anat/sub-sta38_rec-irtk_T2w.nii.gz&#39;</span><span class="p">),</span>
 <span class="s1">&#39;seeds&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">2</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">3</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">4</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz&#39;</span><span class="p">)},</span>
              <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">2</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">3</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">4</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz&#39;</span><span class="p">)},</span>
              <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">2</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">3</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">4</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz&#39;</span><span class="p">)}}),</span>
 <span class="s1">&#39;selected_seeds&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mlabel2subclusters&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
 <span class="s1">&#39;seed_intensities&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mus&#39;</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">109.6722</span><span class="p">,</span> <span class="mf">220.9658</span><span class="p">,</span> <span class="mf">100.9801</span><span class="p">,</span>  <span class="mf">38.6364</span><span class="p">,</span> <span class="mf">125.5148</span><span class="p">,</span> <span class="mf">108.1950</span><span class="p">,</span> <span class="mf">216.1060</span><span class="p">,</span>
          <span class="mf">190.5462</span><span class="p">,</span>  <span class="mf">55.3930</span><span class="p">,</span>  <span class="mf">59.2667</span><span class="p">,</span>  <span class="mf">72.0628</span><span class="p">,</span>  <span class="mf">68.8775</span><span class="p">,</span>  <span class="mf">76.5113</span><span class="p">,</span>  <span class="mf">84.6639</span><span class="p">,</span>
           <span class="mf">90.0124</span><span class="p">,</span>  <span class="mf">94.1701</span><span class="p">,</span>  <span class="mf">67.0610</span><span class="p">,</span>  <span class="mf">25.9465</span><span class="p">,</span>  <span class="mf">31.5438</span><span class="p">,</span>  <span class="mf">21.0375</span><span class="p">,</span> <span class="mf">192.4223</span><span class="p">,</span>
          <span class="mf">173.7434</span><span class="p">,</span> <span class="mf">139.9284</span><span class="p">,</span> <span class="mf">121.3904</span><span class="p">,</span> <span class="mf">145.4289</span><span class="p">,</span> <span class="mf">158.1318</span><span class="p">,</span> <span class="mf">157.4630</span><span class="p">,</span> <span class="mf">150.0894</span><span class="p">,</span>
          <span class="mf">183.9047</span><span class="p">,</span> <span class="mf">181.7129</span><span class="p">,</span> <span class="mf">114.8939</span><span class="p">,</span>   <span class="mf">9.5253</span><span class="p">,</span>  <span class="mf">29.0257</span><span class="p">,</span>  <span class="mf">97.9543</span><span class="p">,</span> <span class="mf">122.0798</span><span class="p">,</span>
           <span class="mf">72.2969</span><span class="p">,</span>  <span class="mf">26.3086</span><span class="p">,</span>  <span class="mf">81.8050</span><span class="p">,</span>  <span class="mf">67.7463</span><span class="p">,</span>  <span class="mf">72.3737</span><span class="p">,</span> <span class="mf">129.8539</span><span class="p">,</span> <span class="mf">113.3900</span><span class="p">,</span>
          <span class="mf">141.8177</span><span class="p">,</span> <span class="mf">225.0000</span><span class="p">,</span>  <span class="mf">35.3458</span><span class="p">,</span> <span class="mf">173.7635</span><span class="p">,</span>  <span class="mf">29.5101</span><span class="p">,</span> <span class="mf">135.9482</span><span class="p">,</span> <span class="mf">188.2391</span><span class="p">,</span>
          <span class="mf">225.0000</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">),</span>
  <span class="s1">&#39;sigmas&#39;</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span> <span class="mf">9.2432</span><span class="p">,</span> <span class="mf">23.1060</span><span class="p">,</span> <span class="mf">16.4965</span><span class="p">,</span>  <span class="mf">6.4289</span><span class="p">,</span> <span class="mf">24.7862</span><span class="p">,</span> <span class="mf">23.7996</span><span class="p">,</span> <span class="mf">15.2424</span><span class="p">,</span> <span class="mf">20.2845</span><span class="p">,</span>
          <span class="mf">12.6833</span><span class="p">,</span>  <span class="mf">6.9079</span><span class="p">,</span>  <span class="mf">6.1214</span><span class="p">,</span> <span class="mf">22.1317</span><span class="p">,</span>  <span class="mf">9.7907</span><span class="p">,</span>  <span class="mf">5.5302</span><span class="p">,</span> <span class="mf">14.3288</span><span class="p">,</span> <span class="mf">11.1454</span><span class="p">,</span>
          <span class="mf">16.0453</span><span class="p">,</span> <span class="mf">20.9057</span><span class="p">,</span> <span class="mf">24.2358</span><span class="p">,</span> <span class="mf">13.4785</span><span class="p">,</span> <span class="mf">22.7258</span><span class="p">,</span> <span class="mf">11.2053</span><span class="p">,</span> <span class="mf">12.9420</span><span class="p">,</span> <span class="mf">13.4270</span><span class="p">,</span>
          <span class="mf">14.8660</span><span class="p">,</span> <span class="mf">22.4874</span><span class="p">,</span>  <span class="mf">5.6251</span><span class="p">,</span>  <span class="mf">9.8794</span><span class="p">,</span>  <span class="mf">8.8749</span><span class="p">,</span> <span class="mf">19.0294</span><span class="p">,</span>  <span class="mf">9.7164</span><span class="p">,</span>  <span class="mf">6.2293</span><span class="p">,</span>
          <span class="mf">13.6376</span><span class="p">,</span> <span class="mf">11.7447</span><span class="p">,</span> <span class="mf">14.1414</span><span class="p">,</span>  <span class="mf">6.4362</span><span class="p">,</span> <span class="mf">20.4575</span><span class="p">,</span> <span class="mf">14.6729</span><span class="p">,</span>  <span class="mf">8.4719</span><span class="p">,</span> <span class="mf">14.2926</span><span class="p">,</span>
           <span class="mf">6.9458</span><span class="p">,</span> <span class="mf">11.5346</span><span class="p">,</span> <span class="mf">14.6113</span><span class="p">,</span>  <span class="mf">6.6516</span><span class="p">,</span> <span class="mf">22.1767</span><span class="p">,</span>  <span class="mf">8.3793</span><span class="p">,</span> <span class="mf">20.1699</span><span class="p">,</span>  <span class="mf">6.3299</span><span class="p">,</span>
           <span class="mf">5.3340</span><span class="p">,</span> <span class="mf">21.8027</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">)},</span>
 <span class="s1">&#39;deform_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;affine&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;rotations&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.0008224</span> <span class="p">,</span>  <span class="mf">0.03067143</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0151502</span> <span class="p">]),</span>
   <span class="s1">&#39;shears&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01735838</span><span class="p">,</span>  <span class="mf">0.00744726</span><span class="p">,</span>  <span class="mf">0.00012507</span><span class="p">]),</span>
   <span class="s1">&#39;scalings&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">1.09345725</span><span class="p">,</span> <span class="mf">0.91695532</span><span class="p">,</span> <span class="mf">0.98194215</span><span class="p">])},</span>
  <span class="s1">&#39;non_rigid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;nonlin_scale&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.05686841</span><span class="p">]),</span>
   <span class="s1">&#39;nonlin_std&#39;</span><span class="p">:</span> <span class="mf">1.048839010036788</span><span class="p">,</span>
   <span class="s1">&#39;size_F_small&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">]},</span>
  <span class="s1">&#39;flip&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
 <span class="s1">&#39;gamma_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">0.960299468352801</span><span class="p">},</span>
 <span class="s1">&#39;bf_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;bf_scale&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;bf_std&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;bf_size&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
 <span class="s1">&#39;resample_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;spacing&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.65685245</span><span class="p">,</span> <span class="mf">0.65685245</span><span class="p">,</span> <span class="mf">0.65685245</span><span class="p">])},</span>
 <span class="s1">&#39;noise_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;noise_std&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
 <span class="s1">&#39;generation_time&#39;</span><span class="p">:</span> <span class="mf">0.5615839958190918</span><span class="p">}</span>
</code></pre></div>
</details>

<p><br>
If the <code>key:value</code> pair exists in the passed <code>genparams</code> dictionary, the <code>sample</code> method will use directly the value from the <code>genparams</code> dictionary. If the <code>key:value</code> pair does not exist in the <code>genparams</code> dictionary or it is <code>None</code>,  <code>sample</code> method will generate the value randomly, using the corresponding class attributes.</p>
<p>See how the keys <code>bf_scale</code>, <code>bf_std</code>, <code>bf_size</code> and <code>noise_std</code> have not been defined in the <code>genparams</code> dictionary above. This means that the <code>sample</code> method will generate these values randomly. The same could have been achieved by not passing them at all.</p>
<details>
    {'idx': 0,
    'img_paths': PosixPath('../data/sub-sta38/anat/sub-sta38_rec-irtk_T2w.nii.gz'),
    'segm_paths': PosixPath('../data/sub-sta38/anat/sub-sta38_rec-irtk_T2w.nii.gz'),
    'seeds': defaultdict(dict,
                {1: {1: PosixPath('../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz'),
                2: PosixPath('../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz'),
                3: PosixPath('../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz'),
                4: PosixPath('../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz')},
                2: {1: PosixPath('../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz'),
                2: PosixPath('../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz'),
                3: PosixPath('../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz'),
                4: PosixPath('../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz')},
                3: {1: PosixPath('../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz'),
                2: PosixPath('../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz'),
                3: PosixPath('../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz'),
                4: PosixPath('../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz')}}),
    'selected_seeds': {'mlabel2subclusters': {1: 2, 2: 1, 3: 3, 4: 1}},
    'seed_intensities': {'mus': tensor([109.6722, 220.9658, 100.9801,  38.6364, 125.5148, 108.1950, 216.1060,
            190.5462,  55.3930,  59.2667,  72.0628,  68.8775,  76.5113,  84.6639,
            90.0124,  94.1701,  67.0610,  25.9465,  31.5438,  21.0375, 192.4223,
            173.7434, 139.9284, 121.3904, 145.4289, 158.1318, 157.4630, 150.0894,
            183.9047, 181.7129, 114.8939,   9.5253,  29.0257,  97.9543, 122.0798,
            72.2969,  26.3086,  81.8050,  67.7463,  72.3737, 129.8539, 113.3900,
            141.8177, 225.0000,  35.3458, 173.7635,  29.5101, 135.9482, 188.2391,
            225.0000], device='cuda:0'),
    'sigmas': tensor([ 9.2432, 23.1060, 16.4965,  6.4289, 24.7862, 23.7996, 15.2424, 20.2845,
            12.6833,  6.9079,  6.1214, 22.1317,  9.7907,  5.5302, 14.3288, 11.1454,
            16.0453, 20.9057, 24.2358, 13.4785, 22.7258, 11.2053, 12.9420, 13.4270,
            14.8660, 22.4874,  5.6251,  9.8794,  8.8749, 19.0294,  9.7164,  6.2293,
            13.6376, 11.7447, 14.1414,  6.4362, 20.4575, 14.6729,  8.4719, 14.2926,
            6.9458, 11.5346, 14.6113,  6.6516, 22.1767,  8.3793, 20.1699,  6.3299,
            5.3340, 21.8027], device='cuda:0')},
    'deform_params': {'affine': {'rotations': array([ 0.0008224 ,  0.03067143, -0.0151502 ]),
    'shears': array([-0.01735838,  0.00744726,  0.00012507]),
    'scalings': array([1.09345725, 0.91695532, 0.98194215])},
    'non_rigid': {'nonlin_scale': array([0.05686841]),
    'nonlin_std': 1.048839010036788,
    'size_F_small': [15, 15, 15]},
    'flip': False},
    'gamma_params': {'gamma': 0.960299468352801},
    'bf_params': {'bf_scale': array([0.00797334]),
    'bf_std': array([0.21896995]),
    'bf_size': [2, 2, 2]},
    'resample_params': {'spacing': array([0.65685245, 0.65685245, 0.65685245])},
    'noise_params': {'noise_std': None},
    'generation_time': 0.6192283630371094}
    ```

</details>
<p><br></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>
<p>If a specific parameter is passed in <code>genparams</code> it means that the probability of its application is 100%. The internal <code>prob</code> is not used as the parameter is fixed.</p>
</li>
<li>
<p>If using custom values for the parameters, ensure that the values are within the range of the parameters defined in the class attributes (especially for the spatial deformation parameters, as the grid is pre-defined at class initialization). Furthermore, ensure that the device location and parameter type is consistent with the one in the returned generation_parameters dictionary.</p>
</li>
</ul>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../configs/" class="btn btn-neutral float-left" title="Configs"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../generation/" class="btn btn-neutral float-right" title="Generation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../configs/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../generation/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>

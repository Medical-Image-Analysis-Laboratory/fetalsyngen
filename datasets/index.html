<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Datasets - FetalSynthGen</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Datasets";
        var mkdocs_page_input_path = "datasets.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../media/fetsynthgen_logo.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">FetalSynthGen GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../usage/">How to use the generator?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../seed_generation/">Seed Generation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configs/">Configs</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Datasets</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#fetalsyngen.data.datasets">datasets</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalDataset">FetalDataset</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalDataset.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalDataset._get_ses">_get_ses</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalDataset._get_pattern">_get_pattern</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalDataset._load_bids_path">_load_bids_path</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalTestDataset">FetalTestDataset</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalTestDataset.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalTestDataset.__getitem__">__getitem__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalTestDataset.reverse_transform">reverse_transform</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalSynthDataset">FetalSynthDataset</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalSynthDataset.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalSynthDataset._load_seed_path">_load_seed_path</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalSynthDataset.sample">sample</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalSynthDataset.__getitem__">__getitem__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta">sample_with_meta</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixed-image-generation">Fixed Image Generation</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../generation/">Generation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sr_artif_api/">Super-resolution artifacts</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">FetalSynthGen</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API</li>
      <li class="breadcrumb-item active">Datasets</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="datasets">Datasets</h1>
<p>Classes for loading and processing datasets.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<blockquote>
<p><strong>üìù Device</strong>: All datasets return samples with tensors on the CPU (even when the synthetic data generation is done on the GPU). This is due to restriction on the GPU usage in the multiprocessing settings, where GPU memory cannot be easily shared between processes.</p>
<p><strong>üìù Dataloader</strong>: When using <code>torch.utils.data.DataLoader</code> ensure that you pass <code>multiprocessing_context="spawn"</code> argument to the dataloader object when using <code>FetalSynthDataset</code> to ensure that the spawned processes have access to the GPU.</p>
</blockquote>


<div class="doc doc-object doc-module">



<a id="fetalsyngen.data.datasets"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="fetalsyngen.data.datasets.FetalDataset" class="doc doc-heading">
            <code>FetalDataset</code>


</h2>


    <div class="doc doc-contents ">


        <p>Abstract class defining a dataset for loading fetal data.</p>






              <details class="quote">
                <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FetalDataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class defining a dataset for loading fetal data.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bids_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sub_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            bids_path: Path to the bids folder with the data.</span>
<span class="sd">            sub_list: List of the subjects to use. If None, all subjects are used.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bids_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_subjects</span><span class="p">(</span><span class="n">sub_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;sub-*&quot;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span> <span class="o">=</span> <span class="n">SimpleITKReader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="n">ScaleIntensity</span><span class="p">(</span><span class="n">minv</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxv</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">Orientation</span><span class="p">(</span><span class="n">axcodes</span><span class="o">=</span><span class="s2">&quot;RAS&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bids_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">,</span> <span class="s2">&quot;T2w&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">segm_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bids_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">,</span> <span class="s2">&quot;dseg&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_subjects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">):</span>
        <span class="n">subj_found</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;sub-*&quot;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">subj_found</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">sub_list</span><span class="p">))</span> <span class="k">if</span> <span class="n">sub_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sub_ses_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ses</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">ses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">sub</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sub_ses_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_ses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bids_path</span><span class="p">,</span> <span class="n">sub</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the session names for the subject.&quot;&quot;&quot;</span>
        <span class="n">sub_path</span> <span class="o">=</span> <span class="n">bids_path</span> <span class="o">/</span> <span class="n">sub</span>
        <span class="n">ses_dir</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sub_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()]</span>
        <span class="n">ses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ses_dir</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;anat&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">ses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ses</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.nii.gz&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the pattern for the file name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ses</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">/anat/</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">*_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ses</span><span class="si">}</span><span class="s2">/anat/</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ses</span><span class="si">}</span><span class="s2">*_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_bids_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;Check that for a given path, all subjects have a file with the provided suffix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">files_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pattern</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No files found for requested subject </span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2"> returned nothing)&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Multiple files found for requested subject </span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2"> returned </span><span class="si">{</span><span class="n">files</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
            <span class="n">files_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">files_paths</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subjects</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;This method should be implemented in the child class.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bids_path</code></b>
                  (<code><span title="str">str</span></code>)
              ‚Äì
              <div class="doc-md-description">
                <p>Path to the bids folder with the data.</p>
              </div>
            </li>
            <li>
              <b><code>sub_list</code></b>
                  (<code><span title="list">list</span>[<span title="str">str</span>] | None</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>List of the subjects to use. If None, all subjects are used.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bids_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sub_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        bids_path: Path to the bids folder with the data.</span>
<span class="sd">        sub_list: List of the subjects to use. If None, all subjects are used.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bids_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_subjects</span><span class="p">(</span><span class="n">sub_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;sub-*&quot;</span><span class="p">)]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subjects</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loader</span> <span class="o">=</span> <span class="n">SimpleITKReader</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="n">ScaleIntensity</span><span class="p">(</span><span class="n">minv</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxv</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">Orientation</span><span class="p">(</span><span class="n">axcodes</span><span class="o">=</span><span class="s2">&quot;RAS&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bids_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">,</span> <span class="s2">&quot;T2w&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">segm_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bids_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bids_path</span><span class="p">,</span> <span class="s2">&quot;dseg&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalDataset._get_ses" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_ses</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the session names for the subject.</p>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_ses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bids_path</span><span class="p">,</span> <span class="n">sub</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the session names for the subject.&quot;&quot;&quot;</span>
    <span class="n">sub_path</span> <span class="o">=</span> <span class="n">bids_path</span> <span class="o">/</span> <span class="n">sub</span>
    <span class="n">ses_dir</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sub_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()]</span>
    <span class="n">ses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ses_dir</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;anat&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">ses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ses</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalDataset._get_pattern" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_get_pattern</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;.nii.gz&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the pattern for the file name.</p>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;.nii.gz&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the pattern for the file name.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ses</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">/anat/</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">*_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">ses</span><span class="si">}</span><span class="s2">/anat/</span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">ses</span><span class="si">}</span><span class="s2">*_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalDataset._load_bids_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_load_bids_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>"Check that for a given path, all subjects have a file with the provided suffix</p>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_load_bids_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;Check that for a given path, all subjects have a file with the provided suffix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">files_paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">sub</span><span class="p">,</span> <span class="n">ses</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pattern</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No files found for requested subject </span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2"> returned nothing)&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Multiple files found for requested subject </span><span class="si">{</span><span class="n">sub</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2"> returned </span><span class="si">{</span><span class="n">files</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
        <span class="n">files_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">files_paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fetalsyngen.data.datasets.FetalTestDataset" class="doc doc-heading">
            <code>FetalTestDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FetalDataset (fetalsyngen.data.datasets.FetalDataset)" href="#fetalsyngen.data.datasets.FetalDataset">FetalDataset</a></code></p>


        <p>Dataset class for loading fetal images offline.
Used to load test/validation data.</p>
<p>Use the <code>transforms</code> argument to pass additional processing steps
(scaling, resampling, cropping, etc.).</p>






              <details class="quote">
                <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FetalTestDataset</span><span class="p">(</span><span class="n">FetalDataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataset class for loading fetal images offline.</span>
<span class="sd">    Used to load test/validation data.</span>

<span class="sd">    Use the `transforms` argument to pass additional processing steps</span>
<span class="sd">    (scaling, resampling, cropping, etc.).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bids_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sub_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">transforms</span><span class="p">:</span> <span class="n">Compose</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            bids_path: Path to the bids folder with the data.</span>
<span class="sd">            sub_list: List of the subjects to use. If None, all subjects are used.</span>
<span class="sd">            transforms: Compose object with the transformations to apply.</span>
<span class="sd">                Default is None, no transformations are applied.</span>

<span class="sd">        !!! Note</span>
<span class="sd">            We highle recommend using the `transforms` arguments with at</span>
<span class="sd">            least the re-oriented transform to RAS and the intensity scaling</span>
<span class="sd">            to `[0, 1]` to ensure the data consistency.</span>

<span class="sd">            See [inference.yaml](https://github.com/Medical-Image-Analysis-Laboratory/fetalsyngen/blob/dev/configs/dataset/transforms/inference.yaml) for an example of the transforms configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="c1"># load the image and segmentation</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">segm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segm_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># add channel dimension</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">segm</span> <span class="o">=</span> <span class="n">segm</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected 3D or 4D image, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="si">}</span><span class="s2">D image.&quot;</span><span class="p">)</span>

        <span class="c1"># transform name into a single string otherwise collate fails</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ses</span><span class="o">=</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">segm</span><span class="o">.</span><span class="n">long</span><span class="p">(),</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with the `image` , `label` and the `name`</span>
<span class="sd">                keys. `image` and `label` are  `torch.float32`</span>
<span class="sd">                [`monai.data.meta_tensor.MetaTensor`](https://docs.monai.io/en/stable/data.html#metatensor)</span>
<span class="sd">                instances  with dimensions `(1, H, W, D)` and `name` is a string</span>
<span class="sd">                of a format `sub_ses` where `sub` is the subject name</span>
<span class="sd">                and `ses` is the session name.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reverse the transformations applied to the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Dictionary with the `image` and `label` keys,</span>
<span class="sd">                like the one returned by the `__getitem__` method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with the `image` and `label` keys where</span>
<span class="sd">                the transformations are reversed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalTestDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">,</span> <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bids_path</code></b>
                  (<code><span title="str">str</span></code>)
              ‚Äì
              <div class="doc-md-description">
                <p>Path to the bids folder with the data.</p>
              </div>
            </li>
            <li>
              <b><code>sub_list</code></b>
                  (<code><span title="list">list</span>[<span title="str">str</span>] | None</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>List of the subjects to use. If None, all subjects are used.</p>
              </div>
            </li>
            <li>
              <b><code>transforms</code></b>
                  (<code><span title="monai.transforms.Compose">Compose</span> | None</code>, default:
                      <code>None</code>
)
              ‚Äì
              <div class="doc-md-description">
                <p>Compose object with the transformations to apply.
Default is None, no transformations are applied.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <div class="admonition note">
<p class="admonition-title">Note</p>
<p>We highle recommend using the <code>transforms</code> arguments with at
least the re-oriented transform to RAS and the intensity scaling
to <code>[0, 1]</code> to ensure the data consistency.</p>
<p>See <a href="https://github.com/Medical-Image-Analysis-Laboratory/fetalsyngen/blob/dev/configs/dataset/transforms/inference.yaml">inference.yaml</a> for an example of the transforms configuration.</p>
</div>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bids_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sub_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">transforms</span><span class="p">:</span> <span class="n">Compose</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        bids_path: Path to the bids folder with the data.</span>
<span class="sd">        sub_list: List of the subjects to use. If None, all subjects are used.</span>
<span class="sd">        transforms: Compose object with the transformations to apply.</span>
<span class="sd">            Default is None, no transformations are applied.</span>

<span class="sd">    !!! Note</span>
<span class="sd">        We highle recommend using the `transforms` arguments with at</span>
<span class="sd">        least the re-oriented transform to RAS and the intensity scaling</span>
<span class="sd">        to `[0, 1]` to ensure the data consistency.</span>

<span class="sd">        See [inference.yaml](https://github.com/Medical-Image-Analysis-Laboratory/fetalsyngen/blob/dev/configs/dataset/transforms/inference.yaml) for an example of the transforms configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span> <span class="o">=</span> <span class="n">transforms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalTestDataset.__getitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="dict">dict</span></code>
              ‚Äì
              <div class="doc-md-description">
                <p>Dictionary with the <code>image</code> , <code>label</code> and the <code>name</code>
keys. <code>image</code> and <code>label</code> are  <code>torch.float32</code>
<a href="https://docs.monai.io/en/stable/data.html#metatensor"><code>monai.data.meta_tensor.MetaTensor</code></a>
instances  with dimensions <code>(1, H, W, D)</code> and <code>name</code> is a string
of a format <code>sub_ses</code> where <code>sub</code> is the subject name
and <code>ses</code> is the session name.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the `image` , `label` and the `name`</span>
<span class="sd">            keys. `image` and `label` are  `torch.float32`</span>
<span class="sd">            [`monai.data.meta_tensor.MetaTensor`](https://docs.monai.io/en/stable/data.html#metatensor)</span>
<span class="sd">            instances  with dimensions `(1, H, W, D)` and `name` is a string</span>
<span class="sd">            of a format `sub_ses` where `sub` is the subject name</span>
<span class="sd">            and `ses` is the session name.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalTestDataset.reverse_transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reverse_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reverse the transformations applied to the data.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>data</code></b>
                  (<code><span title="dict">dict</span></code>)
              ‚Äì
              <div class="doc-md-description">
                <p>Dictionary with the <code>image</code> and <code>label</code> keys,
like the one returned by the <code>__getitem__</code> method.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="dict">dict</span></code>
              ‚Äì
              <div class="doc-md-description">
                <p>Dictionary with the <code>image</code> and <code>label</code> keys where
the transformations are reversed.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reverse_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reverse the transformations applied to the data.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: Dictionary with the `image` and `label` keys,</span>
<span class="sd">            like the one returned by the `__getitem__` method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the `image` and `label` keys where</span>
<span class="sd">            the transformations are reversed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fetalsyngen.data.datasets.FetalSynthDataset" class="doc doc-heading">
            <code>FetalSynthDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="FetalDataset (fetalsyngen.data.datasets.FetalDataset)" href="#fetalsyngen.data.datasets.FetalDataset">FetalDataset</a></code></p>


        <p>Dataset class for generating/augmenting on-the-fly fetal images"</p>






              <details class="quote">
                <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FetalSynthDataset</span><span class="p">(</span><span class="n">FetalDataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataset class for generating/augmenting on-the-fly fetal images&quot; &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bids_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">generator</span><span class="p">:</span> <span class="n">FetalSynthGen</span><span class="p">,</span>
        <span class="n">seed_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sub_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">load_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">image_as_intensity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            bids_path: Path to the bids-formatted folder with the data.</span>
<span class="sd">            seed_path: Path to the folder with the seeds to use for</span>
<span class="sd">                intensity sampling. See `scripts/seed_generation.py`</span>
<span class="sd">                for details on the data formatting. If seed_path is None,</span>
<span class="sd">                the intensity  sampling step is skipped and the output image</span>
<span class="sd">                intensities will be based on the input image.</span>
<span class="sd">            generator: a class object defining a generator to use.</span>
<span class="sd">            sub_list: List of the subjects to use. If None, all subjects are used.</span>
<span class="sd">            load_image: If **True**, the image is loaded and passed to the generator,</span>
<span class="sd">                where it can be used as the intensity prior instead of a random</span>
<span class="sd">                intensity sampling or spatially deformed with the same transformation</span>
<span class="sd">                field as segmentation and the syntehtic image. Default is **False**.</span>
<span class="sd">            image_as_intensity: If **True**, the image is used as the intensity prior,</span>
<span class="sd">                instead of sampling the intensities from the seeds. Default is **False**.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">seed_path</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span> <span class="o">=</span> <span class="n">load_image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">generator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_as_intensity</span> <span class="o">=</span> <span class="n">image_as_intensity</span>

        <span class="c1"># parse seeds paths</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_as_intensity</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Provided seed path </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_load_seed_path</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_seed_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the seeds for the subjects.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed_paths</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">):</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span>
        <span class="p">}</span>
        <span class="n">avail_seeds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;subclasses_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;subclasses_*&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">min_seeds_available</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">avail_seeds</span><span class="p">)</span>
        <span class="n">max_seeds_available</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">avail_seeds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="n">min_seeds_available</span><span class="p">,</span>
            <span class="n">max_seeds_available</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">seed_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;subclasses_</span><span class="si">{</span><span class="n">n_sub</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">seed_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Provided seed path </span><span class="si">{</span><span class="n">seed_path</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># load the seeds for the subjects for each meta label 1-4</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
                <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bids_path</span><span class="p">(</span><span class="n">seed_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;mlabel_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">),</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
                    <span class="n">sub_ses_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">seed_paths</span><span class="p">[</span><span class="n">sub_ses_str</span><span class="p">][</span><span class="n">n_sub</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a single item from the dataset at the specified index.</span>

<span class="sd">        Args:</span>
<span class="sd">            idx (int): The index of the item to retrieve.</span>
<span class="sd">            genparams (dict): Dictionary with generation parameters.</span>
<span class="sd">                Used for fixed generation. Should follow exactly the same structure</span>
<span class="sd">                and be of the same type as the returned generation parameters.</span>
<span class="sd">                Can be used to replicate the augmentations (power)</span>
<span class="sd">                used for the generation of a specific sample.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Dictionaries with the generated data and the generation parameters.</span>
<span class="sd">                First dictionary contains the `image`, `label` and the `name` keys.</span>
<span class="sd">                The second dictionary contains the parameters used for the generation.</span>

<span class="sd">        !!! Note</span>
<span class="sd">            The `image` is scaled to `[0, 1]` and oriented with the `label` to **RAS**</span>
<span class="sd">            and returned on the device  specified in the `generator` initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># use generation_params to track the parameters used for the generation</span>
        <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">segm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segm_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

        <span class="c1"># orient to RAS for consistency</span>
        <span class="n">image</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">segm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">(</span><span class="n">segm</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># transform name into a single string otherwise collate fails</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ses</span><span class="o">=</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># initialize seeds as dictionary</span>
        <span class="c1"># with paths to the seeds volumes</span>
        <span class="c1"># or None if image is to be used as intensity prior</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_paths</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_as_intensity</span><span class="p">:</span>
            <span class="n">seeds</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># log input data</span>
        <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
        <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;img_paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;segm_paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;seeds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="p">)</span>
        <span class="n">generation_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># generate the synthetic data</span>
        <span class="n">gen_output</span><span class="p">,</span> <span class="n">segmentation</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">synth_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
            <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">segmentation</span><span class="o">=</span><span class="n">segm</span><span class="p">,</span> <span class="n">seeds</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="n">genparams</span>
        <span class="p">)</span>

        <span class="c1"># scale the images to [0, 1]</span>
        <span class="n">gen_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="p">(</span><span class="n">gen_output</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># ensure image and segmentation are on the cpu</span>
        <span class="n">gen_output</span> <span class="o">=</span> <span class="n">gen_output</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">segmentation</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span> <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">generation_params</span><span class="p">,</span> <span class="o">**</span><span class="n">synth_params</span><span class="p">}</span>
        <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;generation_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">generation_time_start</span>
        <span class="n">data_out</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">gen_output</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">(),</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">data_out</span><span class="p">,</span> <span class="n">generation_params</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a single item from the dataset at the specified index.</span>

<span class="sd">        Args:</span>
<span class="sd">            idx (int): The index of the item to retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with the `image`, `label` and the `name` keys.</span>
<span class="sd">                `image` and `label` are `torch.float32`</span>
<span class="sd">                [`monai.data.meta_tensor.MetaTensor`](https://docs.monai.io/en/stable/data.html#metatensor)</span>
<span class="sd">                and `name` is a string of a format `sub_ses` where `sub` is the subject name</span>
<span class="sd">                and `ses` is the session name.</span>

<span class="sd">        !!!Note</span>
<span class="sd">            The `image` is scaled to `[0, 1]` and oriented to **RAS** and returned on the device</span>
<span class="sd">            specified in the `generator` initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_out</span><span class="p">,</span> <span class="n">generation_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generation_params</span> <span class="o">=</span> <span class="n">generation_params</span>
        <span class="k">return</span> <span class="n">data_out</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_with_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">genparams</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a sample along with its generation parameters</span>
<span class="sd">        and store them in the same dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            idx: The index of the sample to retrieve.</span>
<span class="sd">            genparams: Dictionary with generation parameters.</span>
<span class="sd">                Used for fixed generation. Should follow exactly the same structure</span>
<span class="sd">                and be of the same type as the returned generation parameters from the `sample()` method.</span>
<span class="sd">                Can be used to replicate the augmentations (power)</span>
<span class="sd">                used for the generation of a specific sample.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with `image`, `label`, `name` and `generation_params` keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">generation_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="n">genparams</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;generation_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generation_params</span>
        <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">seed_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">,</span> <span class="n">load_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">image_as_intensity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bids_path</code></b>
                  (<code><span title="str">str</span></code>)
              ‚Äì
              <div class="doc-md-description">
                <p>Path to the bids-formatted folder with the data.</p>
              </div>
            </li>
            <li>
              <b><code>seed_path</code></b>
                  (<code><span title="str">str</span> | None</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>Path to the folder with the seeds to use for
intensity sampling. See <code>scripts/seed_generation.py</code>
for details on the data formatting. If seed_path is None,
the intensity  sampling step is skipped and the output image
intensities will be based on the input image.</p>
              </div>
            </li>
            <li>
              <b><code>generator</code></b>
                  (<code><a class="autorefs autorefs-internal" title="FetalSynthGen (fetalsyngen.generator.model.FetalSynthGen)" href="../generation/#fetalsyngen.generator.model.FetalSynthGen">FetalSynthGen</a></code>)
              ‚Äì
              <div class="doc-md-description">
                <p>a class object defining a generator to use.</p>
              </div>
            </li>
            <li>
              <b><code>sub_list</code></b>
                  (<code><span title="list">list</span>[<span title="str">str</span>] | None</code>)
              ‚Äì
              <div class="doc-md-description">
                <p>List of the subjects to use. If None, all subjects are used.</p>
              </div>
            </li>
            <li>
              <b><code>load_image</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              ‚Äì
              <div class="doc-md-description">
                <p>If <strong>True</strong>, the image is loaded and passed to the generator,
where it can be used as the intensity prior instead of a random
intensity sampling or spatially deformed with the same transformation
field as segmentation and the syntehtic image. Default is <strong>False</strong>.</p>
              </div>
            </li>
            <li>
              <b><code>image_as_intensity</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              ‚Äì
              <div class="doc-md-description">
                <p>If <strong>True</strong>, the image is used as the intensity prior,
instead of sampling the intensities from the seeds. Default is <strong>False</strong>.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bids_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">generator</span><span class="p">:</span> <span class="n">FetalSynthGen</span><span class="p">,</span>
    <span class="n">seed_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sub_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">load_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">image_as_intensity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        bids_path: Path to the bids-formatted folder with the data.</span>
<span class="sd">        seed_path: Path to the folder with the seeds to use for</span>
<span class="sd">            intensity sampling. See `scripts/seed_generation.py`</span>
<span class="sd">            for details on the data formatting. If seed_path is None,</span>
<span class="sd">            the intensity  sampling step is skipped and the output image</span>
<span class="sd">            intensities will be based on the input image.</span>
<span class="sd">        generator: a class object defining a generator to use.</span>
<span class="sd">        sub_list: List of the subjects to use. If None, all subjects are used.</span>
<span class="sd">        load_image: If **True**, the image is loaded and passed to the generator,</span>
<span class="sd">            where it can be used as the intensity prior instead of a random</span>
<span class="sd">            intensity sampling or spatially deformed with the same transformation</span>
<span class="sd">            field as segmentation and the syntehtic image. Default is **False**.</span>
<span class="sd">        image_as_intensity: If **True**, the image is used as the intensity prior,</span>
<span class="sd">            instead of sampling the intensities from the seeds. Default is **False**.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">bids_path</span><span class="p">,</span> <span class="n">sub_list</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">seed_path</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span> <span class="o">=</span> <span class="n">load_image</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">generator</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">image_as_intensity</span> <span class="o">=</span> <span class="n">image_as_intensity</span>

    <span class="c1"># parse seeds paths</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_as_intensity</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provided seed path </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_seed_path</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset._load_seed_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_load_seed_path</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load the seeds for the subjects.</p>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_load_seed_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the seeds for the subjects.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seed_paths</span> <span class="o">=</span> <span class="p">{</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">):</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span>
    <span class="p">}</span>
    <span class="n">avail_seeds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;subclasses_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;subclasses_*&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">min_seeds_available</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">avail_seeds</span><span class="p">)</span>
    <span class="n">max_seeds_available</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">avail_seeds</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n_sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
        <span class="n">min_seeds_available</span><span class="p">,</span>
        <span class="n">max_seeds_available</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">seed_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;subclasses_</span><span class="si">{</span><span class="n">n_sub</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">seed_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provided seed path </span><span class="si">{</span><span class="n">seed_path</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># load the seeds for the subjects for each meta label 1-4</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_bids_path</span><span class="p">(</span><span class="n">seed_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;mlabel_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">),</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
                <span class="n">sub_ses_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">ses</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seed_paths</span><span class="p">[</span><span class="n">sub_ses_str</span><span class="p">][</span><span class="n">n_sub</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset.sample" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="p">{})</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieve a single item from the dataset at the specified index.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>idx</code></b>
                  (<code><span title="int">int</span></code>)
              ‚Äì
              <div class="doc-md-description">
                <p>The index of the item to retrieve.</p>
              </div>
            </li>
            <li>
              <b><code>genparams</code></b>
                  (<code><span title="dict">dict</span></code>, default:
                      <code>{}</code>
)
              ‚Äì
              <div class="doc-md-description">
                <p>Dictionary with generation parameters.
Used for fixed generation. Should follow exactly the same structure
and be of the same type as the returned generation parameters.
Can be used to replicate the augmentations (power)
used for the generation of a specific sample.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <p>Returns:
    Dictionaries with the generated data and the generation parameters.
        First dictionary contains the <code>image</code>, <code>label</code> and the <code>name</code> keys.
        The second dictionary contains the parameters used for the generation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>image</code> is scaled to <code>[0, 1]</code> and oriented with the <code>label</code> to <strong>RAS</strong>
and returned on the device  specified in the <code>generator</code> initialization.</p>
</div>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a single item from the dataset at the specified index.</span>

<span class="sd">    Args:</span>
<span class="sd">        idx (int): The index of the item to retrieve.</span>
<span class="sd">        genparams (dict): Dictionary with generation parameters.</span>
<span class="sd">            Used for fixed generation. Should follow exactly the same structure</span>
<span class="sd">            and be of the same type as the returned generation parameters.</span>
<span class="sd">            Can be used to replicate the augmentations (power)</span>
<span class="sd">            used for the generation of a specific sample.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Dictionaries with the generated data and the generation parameters.</span>
<span class="sd">            First dictionary contains the `image`, `label` and the `name` keys.</span>
<span class="sd">            The second dictionary contains the parameters used for the generation.</span>

<span class="sd">    !!! Note</span>
<span class="sd">        The `image` is scaled to `[0, 1]` and oriented with the `label` to **RAS**</span>
<span class="sd">        and returned on the device  specified in the `generator` initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># use generation_params to track the parameters used for the generation</span>
    <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">segm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">segm_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

    <span class="c1"># orient to RAS for consistency</span>
    <span class="n">image</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="n">segm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">(</span><span class="n">segm</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># transform name into a single string otherwise collate fails</span>
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_ses</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_ses_string</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ses</span><span class="o">=</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># initialize seeds as dictionary</span>
    <span class="c1"># with paths to the seeds volumes</span>
    <span class="c1"># or None if image is to be used as intensity prior</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">seeds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_paths</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_as_intensity</span><span class="p">:</span>
        <span class="n">seeds</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># log input data</span>
    <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
    <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;img_paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;segm_paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
    <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;seeds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_path</span><span class="p">)</span>
    <span class="n">generation_time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># generate the synthetic data</span>
    <span class="n">gen_output</span><span class="p">,</span> <span class="n">segmentation</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">synth_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">segmentation</span><span class="o">=</span><span class="n">segm</span><span class="p">,</span> <span class="n">seeds</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="n">genparams</span>
    <span class="p">)</span>

    <span class="c1"># scale the images to [0, 1]</span>
    <span class="n">gen_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="p">(</span><span class="n">gen_output</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="c1"># ensure image and segmentation are on the cpu</span>
    <span class="n">gen_output</span> <span class="o">=</span> <span class="n">gen_output</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
    <span class="n">segmentation</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span> <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">generation_params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">generation_params</span><span class="p">,</span> <span class="o">**</span><span class="n">synth_params</span><span class="p">}</span>
    <span class="n">generation_params</span><span class="p">[</span><span class="s2">&quot;generation_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">generation_time_start</span>
    <span class="n">data_out</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">gen_output</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">(),</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">data_out</span><span class="p">,</span> <span class="n">generation_params</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset.__getitem__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieve a single item from the dataset at the specified index.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>idx</code></b>
                  (<code><span title="int">int</span></code>)
              ‚Äì
              <div class="doc-md-description">
                <p>The index of the item to retrieve.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="dict">dict</span></code>
              ‚Äì
              <div class="doc-md-description">
                <p>Dictionary with the <code>image</code>, <code>label</code> and the <code>name</code> keys.
<code>image</code> and <code>label</code> are <code>torch.float32</code>
<a href="https://docs.monai.io/en/stable/data.html#metatensor"><code>monai.data.meta_tensor.MetaTensor</code></a>
and <code>name</code> is a string of a format <code>sub_ses</code> where <code>sub</code> is the subject name
and <code>ses</code> is the session name.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>        <div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>image</code> is scaled to <code>[0, 1]</code> and oriented to <strong>RAS</strong> and returned on the device
specified in the <code>generator</code> initialization.</p>
</div>

            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a single item from the dataset at the specified index.</span>

<span class="sd">    Args:</span>
<span class="sd">        idx (int): The index of the item to retrieve.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the `image`, `label` and the `name` keys.</span>
<span class="sd">            `image` and `label` are `torch.float32`</span>
<span class="sd">            [`monai.data.meta_tensor.MetaTensor`](https://docs.monai.io/en/stable/data.html#metatensor)</span>
<span class="sd">            and `name` is a string of a format `sub_ses` where `sub` is the subject name</span>
<span class="sd">            and `ses` is the session name.</span>

<span class="sd">    !!!Note</span>
<span class="sd">        The `image` is scaled to `[0, 1]` and oriented to **RAS** and returned on the device</span>
<span class="sd">        specified in the `generator` initialization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_out</span><span class="p">,</span> <span class="n">generation_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generation_params</span> <span class="o">=</span> <span class="n">generation_params</span>
    <span class="k">return</span> <span class="n">data_out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_with_meta</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="p">{})</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Retrieve a sample along with its generation parameters
and store them in the same dictionary.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>idx</code></b>
                  (<code><span title="int">int</span></code>)
              ‚Äì
              <div class="doc-md-description">
                <p>The index of the sample to retrieve.</p>
              </div>
            </li>
            <li>
              <b><code>genparams</code></b>
                  (<code><span title="dict">dict</span></code>, default:
                      <code>{}</code>
)
              ‚Äì
              <div class="doc-md-description">
                <p>Dictionary with generation parameters.
Used for fixed generation. Should follow exactly the same structure
and be of the same type as the returned generation parameters from the <code>sample()</code> method.
Can be used to replicate the augmentations (power)
used for the generation of a specific sample.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="dict">dict</span></code>
              ‚Äì
              <div class="doc-md-description">
                <p>A dictionary with <code>image</code>, <code>label</code>, <code>name</code> and <code>generation_params</code> keys.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>fetalsyngen/data/datasets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_with_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">genparams</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a sample along with its generation parameters</span>
<span class="sd">    and store them in the same dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        idx: The index of the sample to retrieve.</span>
<span class="sd">        genparams: Dictionary with generation parameters.</span>
<span class="sd">            Used for fixed generation. Should follow exactly the same structure</span>
<span class="sd">            and be of the same type as the returned generation parameters from the `sample()` method.</span>
<span class="sd">            Can be used to replicate the augmentations (power)</span>
<span class="sd">            used for the generation of a specific sample.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary with `image`, `label`, `name` and `generation_params` keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span><span class="p">,</span> <span class="n">generation_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="n">genparams</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;generation_params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">generation_params</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="fixed-image-generation">Fixed Image Generation</h2>
<p>It is possible to generate synthetic images of the same 'augmentation' power as any given synthetic image. This is done by passing the <code>genparams</code> dictionary to the <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta"><code>sample_with_meta</code></a> (or <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample"><code>sample</code></a>) method of the <a href="#fetalsyngen.data.datasets.FetalSynthDataset"><code>FetalSynthDataset</code></a> class. The <code>generation_params</code> dictionary is a dictionary of the parameters used to generate the image. The method will then use these parameters to generate a new image with the same <code>augmentation power</code> as the original image.</p>
<p>This <code>genparams</code> dictionary can be obtained, for example, from the dictionary returned by the <a href="#fetalsyngen.data.datasets.FetalSynthDataset.sample_with_meta"><code>FetalSynthDataset.sample_with_meta</code></a>  method. It then can be directly used to <code>fix</code> (some or all) generation parameters for the new image.</p>
<p>See example below:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># initialize the dataset class</span>
<span class="c1"># see the Examples page for more details</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">FetalSynthDataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># first sample a synthetic image from the dataset</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">sample_with_meta</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># then we sample a synthetic image with the same augmentation power as the first image</span>
<span class="n">sample_copy</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">sample_with_meta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">genparams</span><span class="o">=</span><span class="n">sample</span><span class="p">[</span><span class="s2">&quot;generation_params&quot;</span><span class="p">])</span>
</code></pre></div>
<p>For example, generation parameters of the first image can be like this:</p>
<details>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="s1">&#39;idx&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s1">&#39;img_paths&#39;</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/sub-sta38/anat/sub-sta38_rec-irtk_T2w.nii.gz&#39;</span><span class="p">),</span>
 <span class="s1">&#39;segm_paths&#39;</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/sub-sta38/anat/sub-sta38_rec-irtk_T2w.nii.gz&#39;</span><span class="p">),</span>
 <span class="s1">&#39;seeds&#39;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span>
             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">2</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">3</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">4</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz&#39;</span><span class="p">)},</span>
              <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">2</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">3</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">4</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz&#39;</span><span class="p">)},</span>
              <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">2</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">3</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz&#39;</span><span class="p">),</span>
               <span class="mi">4</span><span class="p">:</span> <span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz&#39;</span><span class="p">)}}),</span>
 <span class="s1">&#39;selected_seeds&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mlabel2subclusters&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
 <span class="s1">&#39;seed_intensities&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;mus&#39;</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span><span class="mf">109.6722</span><span class="p">,</span> <span class="mf">220.9658</span><span class="p">,</span> <span class="mf">100.9801</span><span class="p">,</span>  <span class="mf">38.6364</span><span class="p">,</span> <span class="mf">125.5148</span><span class="p">,</span> <span class="mf">108.1950</span><span class="p">,</span> <span class="mf">216.1060</span><span class="p">,</span>
          <span class="mf">190.5462</span><span class="p">,</span>  <span class="mf">55.3930</span><span class="p">,</span>  <span class="mf">59.2667</span><span class="p">,</span>  <span class="mf">72.0628</span><span class="p">,</span>  <span class="mf">68.8775</span><span class="p">,</span>  <span class="mf">76.5113</span><span class="p">,</span>  <span class="mf">84.6639</span><span class="p">,</span>
           <span class="mf">90.0124</span><span class="p">,</span>  <span class="mf">94.1701</span><span class="p">,</span>  <span class="mf">67.0610</span><span class="p">,</span>  <span class="mf">25.9465</span><span class="p">,</span>  <span class="mf">31.5438</span><span class="p">,</span>  <span class="mf">21.0375</span><span class="p">,</span> <span class="mf">192.4223</span><span class="p">,</span>
          <span class="mf">173.7434</span><span class="p">,</span> <span class="mf">139.9284</span><span class="p">,</span> <span class="mf">121.3904</span><span class="p">,</span> <span class="mf">145.4289</span><span class="p">,</span> <span class="mf">158.1318</span><span class="p">,</span> <span class="mf">157.4630</span><span class="p">,</span> <span class="mf">150.0894</span><span class="p">,</span>
          <span class="mf">183.9047</span><span class="p">,</span> <span class="mf">181.7129</span><span class="p">,</span> <span class="mf">114.8939</span><span class="p">,</span>   <span class="mf">9.5253</span><span class="p">,</span>  <span class="mf">29.0257</span><span class="p">,</span>  <span class="mf">97.9543</span><span class="p">,</span> <span class="mf">122.0798</span><span class="p">,</span>
           <span class="mf">72.2969</span><span class="p">,</span>  <span class="mf">26.3086</span><span class="p">,</span>  <span class="mf">81.8050</span><span class="p">,</span>  <span class="mf">67.7463</span><span class="p">,</span>  <span class="mf">72.3737</span><span class="p">,</span> <span class="mf">129.8539</span><span class="p">,</span> <span class="mf">113.3900</span><span class="p">,</span>
          <span class="mf">141.8177</span><span class="p">,</span> <span class="mf">225.0000</span><span class="p">,</span>  <span class="mf">35.3458</span><span class="p">,</span> <span class="mf">173.7635</span><span class="p">,</span>  <span class="mf">29.5101</span><span class="p">,</span> <span class="mf">135.9482</span><span class="p">,</span> <span class="mf">188.2391</span><span class="p">,</span>
          <span class="mf">225.0000</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">),</span>
  <span class="s1">&#39;sigmas&#39;</span><span class="p">:</span> <span class="n">tensor</span><span class="p">([</span> <span class="mf">9.2432</span><span class="p">,</span> <span class="mf">23.1060</span><span class="p">,</span> <span class="mf">16.4965</span><span class="p">,</span>  <span class="mf">6.4289</span><span class="p">,</span> <span class="mf">24.7862</span><span class="p">,</span> <span class="mf">23.7996</span><span class="p">,</span> <span class="mf">15.2424</span><span class="p">,</span> <span class="mf">20.2845</span><span class="p">,</span>
          <span class="mf">12.6833</span><span class="p">,</span>  <span class="mf">6.9079</span><span class="p">,</span>  <span class="mf">6.1214</span><span class="p">,</span> <span class="mf">22.1317</span><span class="p">,</span>  <span class="mf">9.7907</span><span class="p">,</span>  <span class="mf">5.5302</span><span class="p">,</span> <span class="mf">14.3288</span><span class="p">,</span> <span class="mf">11.1454</span><span class="p">,</span>
          <span class="mf">16.0453</span><span class="p">,</span> <span class="mf">20.9057</span><span class="p">,</span> <span class="mf">24.2358</span><span class="p">,</span> <span class="mf">13.4785</span><span class="p">,</span> <span class="mf">22.7258</span><span class="p">,</span> <span class="mf">11.2053</span><span class="p">,</span> <span class="mf">12.9420</span><span class="p">,</span> <span class="mf">13.4270</span><span class="p">,</span>
          <span class="mf">14.8660</span><span class="p">,</span> <span class="mf">22.4874</span><span class="p">,</span>  <span class="mf">5.6251</span><span class="p">,</span>  <span class="mf">9.8794</span><span class="p">,</span>  <span class="mf">8.8749</span><span class="p">,</span> <span class="mf">19.0294</span><span class="p">,</span>  <span class="mf">9.7164</span><span class="p">,</span>  <span class="mf">6.2293</span><span class="p">,</span>
          <span class="mf">13.6376</span><span class="p">,</span> <span class="mf">11.7447</span><span class="p">,</span> <span class="mf">14.1414</span><span class="p">,</span>  <span class="mf">6.4362</span><span class="p">,</span> <span class="mf">20.4575</span><span class="p">,</span> <span class="mf">14.6729</span><span class="p">,</span>  <span class="mf">8.4719</span><span class="p">,</span> <span class="mf">14.2926</span><span class="p">,</span>
           <span class="mf">6.9458</span><span class="p">,</span> <span class="mf">11.5346</span><span class="p">,</span> <span class="mf">14.6113</span><span class="p">,</span>  <span class="mf">6.6516</span><span class="p">,</span> <span class="mf">22.1767</span><span class="p">,</span>  <span class="mf">8.3793</span><span class="p">,</span> <span class="mf">20.1699</span><span class="p">,</span>  <span class="mf">6.3299</span><span class="p">,</span>
           <span class="mf">5.3340</span><span class="p">,</span> <span class="mf">21.8027</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="p">)},</span>
 <span class="s1">&#39;deform_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;affine&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;rotations&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.0008224</span> <span class="p">,</span>  <span class="mf">0.03067143</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0151502</span> <span class="p">]),</span>
   <span class="s1">&#39;shears&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.01735838</span><span class="p">,</span>  <span class="mf">0.00744726</span><span class="p">,</span>  <span class="mf">0.00012507</span><span class="p">]),</span>
   <span class="s1">&#39;scalings&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">1.09345725</span><span class="p">,</span> <span class="mf">0.91695532</span><span class="p">,</span> <span class="mf">0.98194215</span><span class="p">])},</span>
  <span class="s1">&#39;non_rigid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;nonlin_scale&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.05686841</span><span class="p">]),</span>
   <span class="s1">&#39;nonlin_std&#39;</span><span class="p">:</span> <span class="mf">1.048839010036788</span><span class="p">,</span>
   <span class="s1">&#39;size_F_small&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">]},</span>
  <span class="s1">&#39;flip&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
 <span class="s1">&#39;gamma_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="mf">0.960299468352801</span><span class="p">},</span>
 <span class="s1">&#39;bf_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;bf_scale&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;bf_std&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;bf_size&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
 <span class="s1">&#39;resample_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;spacing&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mf">0.65685245</span><span class="p">,</span> <span class="mf">0.65685245</span><span class="p">,</span> <span class="mf">0.65685245</span><span class="p">])},</span>
 <span class="s1">&#39;noise_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;noise_std&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
 <span class="s1">&#39;generation_time&#39;</span><span class="p">:</span> <span class="mf">0.5615839958190918</span><span class="p">}</span>
</code></pre></div>
</details>

<p><br>
If the <code>key:value</code> pair exists in the passed <code>genparams</code> dictionary, the <code>sample</code> method will use directly the value from the <code>genparams</code> dictionary. If the <code>key:value</code> pair does not exist in the <code>genparams</code> dictionary or it is <code>None</code>,  <code>sample</code> method will generate the value randomly, using the corresponding class attributes.</p>
<p>See how the keys <code>bf_scale</code>, <code>bf_std</code>, <code>bf_size</code> and <code>noise_std</code> have not been defined in the <code>genparams</code> dictionary above. This means that the <code>sample</code> method will generate these values randomly. The same could have been achieved by not passing them at all.</p>
<details>
    {'idx': 0,
    'img_paths': PosixPath('../data/sub-sta38/anat/sub-sta38_rec-irtk_T2w.nii.gz'),
    'segm_paths': PosixPath('../data/sub-sta38/anat/sub-sta38_rec-irtk_T2w.nii.gz'),
    'seeds': defaultdict(dict,
                {1: {1: PosixPath('../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz'),
                2: PosixPath('../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz'),
                3: PosixPath('../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz'),
                4: PosixPath('../data/derivatives/seeds/subclasses_1/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz')},
                2: {1: PosixPath('../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz'),
                2: PosixPath('../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz'),
                3: PosixPath('../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz'),
                4: PosixPath('../data/derivatives/seeds/subclasses_2/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz')},
                3: {1: PosixPath('../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_1.nii.gz'),
                2: PosixPath('../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_2.nii.gz'),
                3: PosixPath('../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_3.nii.gz'),
                4: PosixPath('../data/derivatives/seeds/subclasses_3/sub-sta38/anat/sub-sta38_rec-irtk_T2w_dseg_mlabel_4.nii.gz')}}),
    'selected_seeds': {'mlabel2subclusters': {1: 2, 2: 1, 3: 3, 4: 1}},
    'seed_intensities': {'mus': tensor([109.6722, 220.9658, 100.9801,  38.6364, 125.5148, 108.1950, 216.1060,
            190.5462,  55.3930,  59.2667,  72.0628,  68.8775,  76.5113,  84.6639,
            90.0124,  94.1701,  67.0610,  25.9465,  31.5438,  21.0375, 192.4223,
            173.7434, 139.9284, 121.3904, 145.4289, 158.1318, 157.4630, 150.0894,
            183.9047, 181.7129, 114.8939,   9.5253,  29.0257,  97.9543, 122.0798,
            72.2969,  26.3086,  81.8050,  67.7463,  72.3737, 129.8539, 113.3900,
            141.8177, 225.0000,  35.3458, 173.7635,  29.5101, 135.9482, 188.2391,
            225.0000], device='cuda:0'),
    'sigmas': tensor([ 9.2432, 23.1060, 16.4965,  6.4289, 24.7862, 23.7996, 15.2424, 20.2845,
            12.6833,  6.9079,  6.1214, 22.1317,  9.7907,  5.5302, 14.3288, 11.1454,
            16.0453, 20.9057, 24.2358, 13.4785, 22.7258, 11.2053, 12.9420, 13.4270,
            14.8660, 22.4874,  5.6251,  9.8794,  8.8749, 19.0294,  9.7164,  6.2293,
            13.6376, 11.7447, 14.1414,  6.4362, 20.4575, 14.6729,  8.4719, 14.2926,
            6.9458, 11.5346, 14.6113,  6.6516, 22.1767,  8.3793, 20.1699,  6.3299,
            5.3340, 21.8027], device='cuda:0')},
    'deform_params': {'affine': {'rotations': array([ 0.0008224 ,  0.03067143, -0.0151502 ]),
    'shears': array([-0.01735838,  0.00744726,  0.00012507]),
    'scalings': array([1.09345725, 0.91695532, 0.98194215])},
    'non_rigid': {'nonlin_scale': array([0.05686841]),
    'nonlin_std': 1.048839010036788,
    'size_F_small': [15, 15, 15]},
    'flip': False},
    'gamma_params': {'gamma': 0.960299468352801},
    'bf_params': {'bf_scale': array([0.00797334]),
    'bf_std': array([0.21896995]),
    'bf_size': [2, 2, 2]},
    'resample_params': {'spacing': array([0.65685245, 0.65685245, 0.65685245])},
    'noise_params': {'noise_std': None},
    'generation_time': 0.6192283630371094}
    ```

</details>
<p><br></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>
<p>If a specific parameter is passed in <code>genparams</code> it means that the probability of its application is 100%. The internal <code>prob</code> is not used as the parameter is fixed.</p>
</li>
<li>
<p>If using custom values for the parameters, ensure that the values are within the range of the parameters defined in the class attributes (especially for the spatial deformation parameters, as the grid is pre-defined at class initialization). Furthermore, ensure that the device location and parameter type is consistent with the one in the returned generation_parameters dictionary.</p>
</li>
</ul>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../configs/" class="btn btn-neutral float-left" title="Configs"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../generation/" class="btn btn-neutral float-right" title="Generation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../configs/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../generation/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
